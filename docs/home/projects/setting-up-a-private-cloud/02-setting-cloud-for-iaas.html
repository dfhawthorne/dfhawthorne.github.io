---
layout: default
title: '02 Setting Cloud for IaaS'
base-url: home/projects/setting-up-a-private-cloud/02-setting-cloud-for-iaas.html
breadcrumbs:
- title: 'Home'
  url: index.html
- title: 'Projects'
  url: home/projects.html
- title: 'Setting Up a Private Cloud'
  url: home/projects/setting-up-a-private-cloud.html
- title: '02 Setting Cloud for IaaS'
  url: home/projects/setting-up-a-private-cloud/02-setting-cloud-for-iaas.html
scroll-bar:
  left-link:
    url: home/projects/setting-up-a-private-cloud/01-setting-up-the-cloud-management-infrastructure.html
    title: '01 Setting Up the Cloud Management Infrastructure'
  right-link:
    url: home/projects/setting-up-a-private-cloud/03-setting-cloud-for-iaas-2.html
    title: '03 Setting Cloud for IaaS 2'
table-of-contents:
- toc-url: 'Overview'
  toc-text: 'Overview'
- toc-url: 'References'
  toc-text: 'References'
- toc-url: 'Procedure'
  toc-text: 'Procedure'
  toc-menu:
  - toc-url: '4.1-Getting-Started'
    toc-text: '4.1 Getting Started'
  - toc-url: '4.1-Cloud-Infrastructure-Privileges'
    toc-text: '4.1 Cloud Infrastructure Privileges'
  - toc-url: '4.2-Registering-the-Oracle-VM-Manager'
    toc-text: '4.2 Registering the Oracle VM Manager'
    toc-menu:
    - toc-url: 'Enable-Remote-Log-Ins-for-OVMM'
      toc-text: 'Enable Remote Log-Ins for OVMM'
    - toc-url: 'Update-.bash_profile'
      toc-text: 'Update .bash_profile'
    - toc-url: 'Export-OVMM-Certificate'
      toc-text: 'Export OVMM Certificate'
    - toc-url: 'Import-OVMM-Certificate-into-OEM-Agent'
      toc-text: 'Import OVMM Certificate into OEM Agent'
    - toc-url: 'Remove-the-Exported-OVMM-Certificate'
      toc-text: 'Remove the Exported OVMM Certificate'
    - toc-url: 'Deploy-Virtualization-Plug-In'
      toc-text: 'Deploy Virtualization Plug-In'
    - toc-url: 'First-Attempt-to-Register-OVMM'
      toc-text: 'First Attempt to Register OVMM'
    - toc-url: 'Diagnosis-of-Error'
      toc-text: 'Diagnosis of Error'
- toc-url: 'Issue'
  toc-text: 'Issue'
---

<!-- {% raw %} -->
<div dir="ltr">

<br/>
<h2>
<a name="TOC-Overview">
</a>
                    Overview
                   </h2>
<p>
                    Now that the preparation work has been done, I am now ready to IAAS (Infrastructure as a Service) on my private cloud.
                   </p>
<h2>
<a name="TOC-References">
</a>
                    References
                   </h2>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/toc.htm#BEGIN" rel="nofollow">
                      Oracle® Enterprise Manager Cloud Administration Guide 12c Release 3 (12.1.0.3)
                     </a>
</li>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#CEGFJIHI" rel="nofollow">
                       4 Setting Cloud for IaaS
                      </a>
</li>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#CEGFBGCJ" rel="nofollow">
                        4.1 Getting Started
                       </a>
</li>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#BABDDGGD" rel="nofollow">
                        4.1 Cloud Infrastructure Privileges
                       </a>
</li>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#CEGICIFE" rel="nofollow">
                        4.2 Registering the Oracle VM Manager
                       </a>
</li>
</ul>
</ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e24473/toc.htm" rel="nofollow">
                      Oracle® Enterprise Manager Cloud Control Administrator's Guide 12c Release 3 (12.1.0.3)
                     </a>
</li>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e24473/plugin_mngr.htm#CHDBGHFE" rel="nofollow">
                       15 Managing Plug-Ins
                      </a>
</li>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e24473/plugin_mngr.htm#CJGCHGIH" rel="nofollow">
                        15.4 Actions that Can Be Performed Using Plug-In Manager
                       </a>
</li>
<ul>
<li>
<a href="http://docs.oracle.com/cd/E24628_01/doc.121/e24473/plugin_mngr.htm#CJGBIAGJ" rel="nofollow">
                         15.4.7 Deploying Plug-Ins on Oracle Management Agent
                        </a>
</li>
</ul>
</ul>
</ul>
<li>
<a href="https://support.oracle.com/epmos/faces/DocContentDisplay?id=1490283.1" rel="nofollow">
                      EM 12c: OVM Manager Metric Collection Error or Registration not working after upgrading to Enterprise Manager 12c Release 2 (Doc ID 1490283.1)
                     </a>
</li>
</ul>
<h2>
<a name="TOC-Procedure">
</a>
                    Procedure
                   </h2>
<h3>
<a name="TOC-4.1-Getting-Started">
</a>
                    4.1 Getting Started
                   </h3>
<p>
                    Following the procedure in
                    <a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#CEGFBGCJ" rel="nofollow">
                     4.1 Getting Started
                    </a>
                    , I think I have all the necessary elements in place:
                   </p>
<ul>
<li>
                     OVM Manager has been installed on
                     <span style="font-family:monospace">
                      MELBOURNE
                     </span>
                     .
                    </li>
<li>
                     OVM Server has been installed on
                     <span style="font-family:monospace">
                      VICTORIA
                     </span>
                     .
                    </li>
<li>
                     Network Accessible Storage is available on
                     <span style="font-family:monospace">
                      NARRABRI
                     </span>
                     .
                    </li>
</ul>
<h3>
<a name="TOC-4.1-Cloud-Infrastructure-Privileges">
</a>
                    4.1 Cloud Infrastructure Privileges
                   </h3>
<p>
                    Since this is a test installation of a private cloud, I will skip over the procedure in
                    <a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#BABDDGGD" rel="nofollow">
                     4.1 Cloud Infrastructure Privileges
                    </a>
                    . There is no need for a sophisticated security model at this stage.
                   </p>
<h3>
<a name="TOC-4.2-Registering-the-Oracle-VM-Manager">
</a>
                    4.2 Registering the Oracle VM Manager
                   </h3>
<h4>
<a name="TOC-Enable-Remote-Log-Ins-for-OVMM">
</a>
                    Enable Remote Log-Ins for OVMM
                   </h4>
<p>
                    Following the procedure in
                    <a href="http://docs.oracle.com/cd/E24628_01/doc.121/e28814/cloud_iaas_setup.htm#CEGICIFE" rel="nofollow">
                     4.2 Registering the Oracle VM Manager
                    </a>
                    , I discovered I had to enable remote log ins as described in
                    <a href="home/system-builds/melbourne/03-enabling-remote-log-ins.html">
                     03 Enabling Remote Log Ins
                    </a>
                    before I could proceed.
                   </p>
<h4>
<a name="TOC-Update-.bash_profile">
</a>
                    Update .bash_profile
                   </h4>
<p>
                    On
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    , I added the following variables to
                    <code>
                     ~/.bash_profile
                    </code>
                    for
                    <code>
                     oracle
                    </code>
                    :
                   </p>
<pre>export JAVA_HOME=/u01/app/oracle/java
export AGENT_INSTANCE_HOME=/u01/app/oracle/agent/agent_inst
export OVM_MANAGER_HOME=/u01/app/oracle/ovm-manager-3
</pre>
<p>
                    I set these variables as follows:
                   </p>
<pre>. ~/.bash_profile
</pre>
<h4>
<a name="TOC-Export-OVMM-Certificate">
</a>
                    Export OVMM Certificate
                   </h4>
<p>
                    On
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    , I exported the OVMM certificate generated in
                    <a href="home/system-builds/melbourne/03-enabling-remote-log-ins.html">
                     03 Enabling Remote Log Ins
                    </a>
                    , as follows:
                   </p>
<pre>${JAVA_HOME}/bin/keytool -keystore ${OVM_MANAGER_HOME}/ovmmCoreTcps.ks -exportcert -alias ovmm -file /tmp/ovmm_cert
</pre>
<p>
                    I entered the OVMM Key Store password when prompted as follows:
                   </p>
<pre>Enter keystore password:
Certificate stored in file &lt;/tmp/ovmm_cert&gt;
</pre>
<h4>
<a name="TOC-Import-OVMM-Certificate-into-OEM-Agent">
</a>
                    Import OVMM Certificate into OEM Agent
                   </h4>
<p>
                    I used the following command to import the exported OVMM certificate into the key store for the OEM agent on
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    :
                   </p>
<pre>${AGENT_INSTANCE_HOME}/bin/emctl secure add_trust_cert_to_jks -trust_certs_loc /tmp/ovmm_cert -alias ovmm
</pre>
<p>
                    I entered
                    <code>
                     welcome
                    </code>
                    when prompted below:
                   </p>
<pre>Oracle Enterprise Manager Cloud Control 12c Release 3
Copyright (c) 1996, 2013 Oracle Corporation.  All rights reserved.
Password:

Message   :   Certificate was added to keystore
ExitStatus: SUCCESS
</pre>
<h4>
<a name="TOC-Remove-the-Exported-OVMM-Certificate">
</a>
                    Remove the Exported OVMM Certificate
                   </h4>
<p>
                    On
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    , I cleaned up the exported OVMM certificate as follows:
                   </p>
<pre>rm -f /tmp/ovmm_cert
</pre>
<h4>
<a name="TOC-Deploy-Virtualization-Plug-In">
</a>
                    Deploy Virtualization Plug-In
                   </h4>
<p>
                    I used the plug-in deployment procedure described in
                    <a href="http://docs.oracle.com/cd/E24628_01/doc.121/e24473/plugin_mngr.htm#CJGBIAGJ" rel="nofollow">
                     15.4.7 Deploying Plug-Ins on Oracle Management Agent
                    </a>
                    to deploy the
                    <cite>
                     Oracle Virtualization
                    </cite>
                    (12.1.0.5.0) Plug-In to the OEM agent on
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    only:
                   </p>
<div style="display:block;text-align:left">

<img border="0" src="home/projects/setting-up-a-private-cloud/02-setting-cloud-for-iaas/02 Deploy Agent Virrtualization Plugin.png"/>

</div>
<br/>
<h4>
<a name="TOC-First-Attempt-to-Register-OVMM">
</a>
                    First Attempt to Register OVMM
                   </h4>
<p>
                    I used the following parameters to register the OVMM on
                    <span style="font-family:monospace">
                     MELBOURNE
                    </span>
                    :
                   </p>
<table border="1">
<thead>
<tr>
<th>
                       Parameter
                      </th>
<th>
                       Value
                      </th>
</tr>
</thead>
<tbody>
<tr>
<td>
                       Name
                      </td>
<td>
                       Melbourne
                      </td>
</tr>
<tr>
<td>
                       Monitoring Agent
                      </td>
<td>
                       melbourne.yaocm.id.au:3872
                      </td>
</tr>
<tr>
<td>
                       Oracle VM Manager URL
                      </td>
<td>
                       tcps://melbourne.yaocm.id.au:54322/
                      </td>
</tr>
<tr>
<td>
                       Oracle VM Manager Console URL
                      </td>
<td>
                       https://melbourne.yaocm.id.au:7002/
                      </td>
</tr>
<tr>
<td>
                       Username
                      </td>
<td>
                       admin
                      </td>
</tr>
<tr>
<td>
                       Use Administration Credentials
                      </td>
<td>
                       No
                       <br/>
</td>
</tr>
<tr>
<td>
                       Automatic Synchronization with Oracle VM Manager
                      </td>
<td>
                       Yes
                      </td>
</tr>
</tbody>
</table>
<p>
                    The job failed with the following messages:
                   </p>
<blockquote style="font-family:monospace">
                    4321: Error getting uuid.
                    <br/>
                    Executing command /u01/app/oracle/agent/core/12.1.0.3.0/jdk/bin/java -Xmx256m -Djavax.net.ssl.trustStore=/u01/app/oracle/agent/agent_inst/sysman/config/montrust/AgentTrust.jks -classpath /u01/app/oracle/agent/core/12.1.0.3.0/sysman/jlib/emagentSDK.jar:/u01/app/oracle/agent/core/12.1.0.3.0/sysman/jlib/log4j-core.jar:/u01/app/oracle/agent/core/12.1.0.3.0/sysman/jlib/emagentSDK-intg.jar:/u01/app/oracle/agent/core/12.1.0.3.0/jlib/gcagent_core.jar:/u01/app/oracle/agent/plugins/oracle.sysman.vt.agent.plugin_12.1.0.5.0/archives/OvmClient.jar:/u01/app/oracle/agent/plugins/oracle.sysman.vt.agent.plugin_12.1.0.5.0/archives/commons-logging-1.0.4.jar:/u01/app/oracle/agent/plugins/oracle.sysman.vt.agent.plugin_12.1.0.5.0/archives/em-vt-fetchlet-pojo.jar:/u01/app/oracle/agent/plugins/oracle.sysman.vt.agent.plugin_12.1.0.5.0/archives/em-vt-ovmintegration-pojo.jar:/u01/app/oracle/agent/plugins/oracle.sysman.vt.agent.plugin_12.1.0.5.0/archives/em-vt-ovmintegrationcore-pojo.jar:/u01/app/oracle/agent/core/12.1.0.3.0/lib/jsch.jar oracle.sysman.vt.fetchlet.pojo.AsyncOVMWrapper
                    <br/>
<br/>
                    OVM Manager URL = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    OVM Manager Username = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    OVM Manager Password = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    OVM Manager UUID = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    Manager ID = SyncManager
                    <br/>
                    Method Name = getOvmMgrUuid
                    <br/>
                    Param Types = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    paramValues = &lt;sensitive value not to be displayed&gt;
                    <br/>
                    Retry Count = 0
                    <br/>
                    Retry Sleep Interval = 0
                    <br/>
<br/>
                    Operation failed
                    <br/>
                    oracle.sysman.vt.ovm.integration.api.EMOVMCommunicationServiceException: 1010: Error while performing the operation: Connection to the remote OVM Manager URL tcps://melbourne.yaocm.id.au:54322 failed. Ensure that the OVM Manager version is 3.0.2 or greater and the service URL and the credentials are correct.Check exception cause and logs for more details.[com.oracle.ovm.mgr.api.exception.FailedOperationException:OVMAPI_6000E Internal Error: Connection refused Connection refused ]
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.OVMMConnectionCreatorValidator.checkForDone(OVMMConnectionCreatorValidator.java:212)
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.OVMMConnectionCreatorValidator.create(OVMMConnectionCreatorValidator.java:87)
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.OVMManagerConnection.createOvmManagerConnection(OVMManagerConnection.java:448)
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.OVMManagerConnection.connect(OVMManagerConnection.java:271)
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.AbstractCoreManager.init(AbstractCoreManager.java:58)
                    <br/>
                    at oracle.sysman.vt.ovm.integration.core.SyncManagerImpl.getOvmMgrUuid(SyncManagerImpl.java:592)
                    <br/>
                    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
                    <br/>
                    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
                    <br/>
                    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
                    <br/>
                    at java.lang.reflect.Method.invoke(Method.java:597)
                    <br/>
                    at oracle.sysman.vt.fetchlet.pojo.OVMDataFetchletUtil.executeOperation(OVMDataFetchletUtil.java:265)
                    <br/>
                    at oracle.sysman.vt.fetchlet.pojo.OVMDataFetchletUtil.executeOperation(OVMDataFetchletUtil.java:144)
                    <br/>
                    at oracle.sysman.vt.fetchlet.pojo.OVMDataFetchletUtil.executeOperation(OVMDataFetchletUtil.java:72)
                    <br/>
                    at oracle.sysman.vt.fetchlet.pojo.AsyncOVMWrapper.main(AsyncOVMWrapper.java:126)
                    <br/>
                    Exit code: 242
                    <br/>
</blockquote>
<h4>
<a name="TOC-Diagnosis-of-Error">
</a>
                    Diagnosis of Error
                   </h4>
<p>
<a href="http://www.pythian.com/blog/author/velikanov" rel="nofollow">
                     Yury Velikanov
                    </a>
                    at
                    <a href="http://www.pythian.com/blog/oracle-vm-manager-ovmapi_6000e-internal-error-connection-refused-connection-refused/" rel="nofollow">
                     Oracle VM Manager: OVMAPI_6000E Internal Error: Connection Refused
                    </a>
                    says that:
                   </p>
<blockquote>
                    If you see that error and try looking for a solution on Google, then unfortunately for you it is a very generic error message (a.k.a. ORA-600 in Oracle VM world ;) ) and you will need to dig a bit to find out what exactly is wrong in your case.
                   </blockquote>
<p>
                    Following Yuri's advice, I ran the following command:
                   </p>
<pre>grep -i "error"  /u01/app/oracle/ovm-manager-3/machine1/base_adf_domain/servers/AdminServer/logs/AdminServer.log
</pre>
<p>
                    The results are:
                   </p>
<blockquote style="font-family:monospace">
                    wlw.logErrorsToConsole = false
                    <br/>
                    ####&lt;May 17, 2014 6:35:21 PM EST&gt; &lt;Info&gt; &lt;com.oracle.odof.core.WorkflowManager&gt; &lt;melbourne.yaocm.id.au&gt; &lt;AdminServer&gt; &lt;[ACTIVE] ExecuteThread: '0' for queue: 'weblogic.kernel.Default (self-tuning)'&gt; &lt;&lt;anonymous&gt;&gt; &lt;&gt; &lt;0000KO9KP^XFW7WFLzuHOA1JTlwK000002&gt; &lt;1400315721569&gt; &lt;BEA-000000&gt; &lt;Failed to start tcps service at port: 54322 message: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)
                    <br/>
                    java.net.SocketException: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)
                    <br/>
                    Caused By: java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)
                    <br/>
</blockquote>
<h2>
<a name="TOC-Issue">
</a>
                    Issue
                   </h2>
<p>
                    This was investigated as  the issue described in
                    <a href="home/issues/ovm-issues/ovmm-fails-to-enable-tcps-connections.html">
                     OVMM Fails to Enable TCPS Connections
                    </a>
                    .
                   </p>

</div>
<!-- {% endraw %} -->
