---
layout: default
title: 'Detect and repair data failures with Data Recovery Advisor'
base-url: home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration/detect-and-repair-data-failures-with-data-recovery-advisor.html
breadcrumbs:
- title: 'Home'
  url: index.html
- title: '12C OCP Upgrade'
  url: home/12c-ocp-upgrade.html
- title: 'Section 2: Key DBA Skills'
  url: home/12c-ocp-upgrade/section-2-key-dba-skills.html
- title: 'Core Administration'
  url: home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration.html
- title: 'Detect and repair data failures with Data Recovery Advisor'
  url: home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration/detect-and-repair-data-failures-with-data-recovery-advisor.html
table-of-contents:
- toc-url: 'Summary'
  toc-text: 'Summary'
- toc-url: 'References'
  toc-text: 'References'
  toc-menu:
  - toc-url: 'Oracle-Manuals'
    toc-text: 'Oracle Manuals'
- toc-url: 'Sample-Session'
  toc-text: 'Sample Session'
  toc-menu:
  - toc-url: 'List-Failure'
    toc-text: 'List Failure'
  - toc-url: 'Advise-Failure'
    toc-text: 'Advise Failure'
  - toc-url: 'Repair-Failure-Automatically'
    toc-text: 'Repair Failure Automatically'
  - toc-url: 'Check-for-Other-Failures'
    toc-text: 'Check for Other Failures'
  - toc-url: 'Get-Advice-for-Other-Failures'
    toc-text: 'Get Advice for Other Failures'
  - toc-url: 'Find-PDB-for-DEMO-Tablespace'
    toc-text: 'Find PDB for DEMO Tablespace'
  - toc-url: 'Drop-DEMO-Tablespace-in-PLUM-PDB'
    toc-text: 'Drop DEMO Tablespace in PLUM PDB'
  - toc-url: 'Verify-No-Further-RMAN-Issues-Exist'
    toc-text: 'Verify No Further RMAN Issues Exist'
- toc-url: 'Using-OEM-12C'
  toc-text: 'Using OEM 12C'
  toc-menu:
  - toc-url: 'Access-Advisor-Central'
    toc-text: 'Access Advisor Central'
  - toc-url: 'Access-Data-Recovery-Advisor'
    toc-text: 'Access Data Recovery Advisor'
  - toc-url: 'View-and-Manage-Failures'
    toc-text: 'View and Manage Failures'
---
<div dir="ltr">
 <br/>
 <h2>
  <a name="TOC-Summary">
  </a>
  Summary
 </h2>
 <p>
  There are three (3) RMAN commands:
 </p>
 <ol>
  <li style="font-family:monospace;background-color:#f2f2f2">
   list failure
  </li>
  <li style="font-family:monospace;background-color:#f2f2f2">
   advise failure
  </li>
  <li style="font-family:monospace;background-color:#f2f2f2">
   repair failure
  </li>
 </ol>
 <h2>
  <a name="TOC-References">
  </a>
  References
 </h2>
 <h3>
  <a name="TOC-Oracle-Manuals">
  </a>
  Oracle Manuals
 </h3>
 <ul>
  <li>
   <a href="https://docs.oracle.com/database/121/RCMRF/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database Backup and Recovery Reference
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta.htm#GUID-8757D5C8-9360-4696-B5EF-5E6D0F8E5440" rel="nofollow">
     2 RMAN Commands: @ (at sign) to QUIT
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C" rel="nofollow">
      ADVISE FAILURE
     </a>
    </li>
    <li>
     <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta027.htm#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E" rel="nofollow">
      LIST
     </a>
    </li>
   </ul>
   <li>
    <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta2.htm#GUID-C3809416-7521-4C18-AA50-B2B52A56DCFF" rel="nofollow">
     3 RMAN Commands: RECOVER to VALIDATE
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta2004.htm#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98" rel="nofollow">
      REPAIR FAILURE
     </a>
    </li>
    <li>
     <a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta2006.htm#GUID-8352987F-533A-4146-A157-F091103169B0" rel="nofollow">
      REPORT
     </a>
    </li>
   </ul>
  </ul>
  <li>
   <a href="https://docs.oracle.com/database/121/BRADV/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database Backup and Recovery User's Guide
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/BRADV/rcmintro.htm#BRADV8001" rel="nofollow">
     1 Introduction to Backup and Recovery
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/BRADV/rcmintro.htm#BRADV89345" rel="nofollow">
      About Data Recovery Advisor
     </a>
    </li>
   </ul>
   <li>
    <a href="https://docs.oracle.com/database/121/BRADV/rcmrepai.htm#BRADV246" rel="nofollow">
     15 Diagnosing and Repairing Failures with Data Recovery Advisor
    </a>
   </li>
  </ul>
  <li>
   <a href="https://docs.oracle.com/database/121/ADMIN/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database Administrator's Guide
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/ADMIN/diag.htm#ADMIN11007" rel="nofollow">
     9 Managing Diagnostic Data
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/ADMIN/diag.htm#ADMIN12487" rel="nofollow">
      9.9 Repairing Data Corruptions with the Data Recovery Advisor
     </a>
    </li>
   </ul>
  </ul>
 </ul>
 <h2>
  <a name="TOC-Sample-Session">
  </a>
  Sample Session
 </h2>
 <h3>
  <a name="TOC-List-Failure">
  </a>
  List Failure
 </h3>
 <p>
  In order to find what recovery errors there are, I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta027.htm#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E" rel="nofollow">list</a> failure;
</pre>
 <p>
  The known failures were:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected       Summary
---------- -------- --------- ------------------- -------
642        CRITICAL OPEN      2018/04/29 22:20:33 System datafile 11: '/opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_system_c7kqc77v_.dbf' needs media recovery
645        HIGH     OPEN      2018/04/29 22:20:34 One or more non-system datafiles need media recovery
622        HIGH     OPEN      2018/04/29 21:25:32 One or more non-system datafiles are missing
</pre>
 <h3>
  <a name="TOC-Advise-Failure">
  </a>
  Advise Failure
 </h3>
 <p>
  In order to find what recovery options there are, I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C" rel="nofollow">advise failure</a>;
</pre>
 <p>
  The known failures were:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected       Summary
---------- -------- --------- ------------------- -------
642        CRITICAL OPEN      2018/04/29 22:20:33 System datafile 11: '/opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_system_c7kqc77v_.dbf' needs media recovery
645        HIGH     OPEN      2018/04/29 22:20:34 One or more non-system datafiles need media recovery
622        HIGH     OPEN      2018/04/29 21:25:32 One or more non-system datafiles are missing

analyzing automatic repair options; this may take some time
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID=61 device type=DISK
analyzing automatic repair options complete

Mandatory Manual Actions
========================
1. If file /opt/app/oracle/oradata/transport/o1_mf_demo_fg8ssf96_.dbf was unintentionally renamed or moved, restore it
2. If you have an export of tablespace DEMO, then drop and re-create the tablespace and import the data.
3. Contact Oracle Support Services if the preceding recommendations cannot be used, or if they do not fix the failures selected for repair

Optional Manual Actions
=======================
1. If you restored the wrong version of data file /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_system_c7kqc77v_.dbf, then replace it with the correct one
2. Automatic repairs may be available if you shutdown the database and restart it in mount mode
3. If you restored the wrong version of data file /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_sysaux_c7kqc77w_.dbf, then replace it with the correct one
4. If you restored the wrong version of data file /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_users_c7kqc77w_.dbf, then replace it with the correct one

Automated Repair Options
========================
Option Repair Description
------ ------------------
1      Recover datafile 11; Recover datafile 12; Recover datafile 13
  Strategy: The repair includes complete media recovery with no data loss
  Repair script: /opt/app/oracle/diag/rdbms/jar/jar/hm/reco_3230405272.hm
</pre>
 <h3>
  <a name="TOC-Repair-Failure-Automatically">
  </a>
  Repair Failure Automatically
 </h3>
 <p>
  In order to find what recovery options there are, I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta2004.htm#GUID-8BF5A460-940A-41D0-9A8B-C14A303DEA98" rel="nofollow">repair failure</a>;
</pre>
 <p>
  The failures were repaired as follows by RMAN:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Strategy: The repair includes complete media recovery with no data loss
Repair script: /opt/app/oracle/diag/rdbms/jar/jar/hm/reco_3230405272.hm

contents of repair script:
   # recover datafile
   recover datafile 11, 12, 13;

Do you really want to execute the above repair (enter YES or NO)? yes
executing repair script

Starting recover at 2018/04/29 22:22:50
using channel ORA_DISK_1

starting media recovery
media recovery complete, elapsed time: 00:00:02

Finished recover at 2018/04/29 22:22:55
repair failure complete
</pre>
 <h3>
  <a name="TOC-Check-for-Other-Failures">
  </a>
  Check for Other Failures
 </h3>
 <p>
  In order to there are any subsequent recovery errors, I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance:
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta027.htm#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E" rel="nofollow">list failure</a>;
</pre>
 <p>
  The failures were:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected       Summary
---------- -------- --------- ------------------- -------
622        HIGH     OPEN      2018/04/29 21:25:32 One or more non-system datafiles are missing
</pre>
 <h3>
  <a name="TOC-Get-Advice-for-Other-Failures">
  </a>
  Get Advice for Other Failures
 </h3>
 <p>
  In order to get advice on these new recovery errors, I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance:
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta003.htm#GUID-40985161-61A8-4C0A-9BEF-1DEECBCDF49C" rel="nofollow">advise failure</a>;
</pre>
 <p>
  The failures were:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Database Role: PRIMARY

List of Database Failures
=========================

Failure ID Priority Status    Time Detected       Summary
---------- -------- --------- ------------------- -------
622        HIGH     OPEN      2018/04/29 21:25:32 One or more non-system datafiles are missing

analyzing automatic repair options; this may take some time
using channel ORA_DISK_1
analyzing automatic repair options complete

Mandatory Manual Actions
========================
1. If file /opt/app/oracle/oradata/transport/o1_mf_demo_fg8ssf96_.dbf was unintentionally renamed or moved, restore it
2. If you have an export of tablespace DEMO, then drop and re-create the tablespace and import the data.
3. Contact Oracle Support Services if the preceding recommendations cannot be used, or if they do not fix the failures selected for repair

Optional Manual Actions
=======================
no manual actions available

Automated Repair Options
========================
no automatic repair options available
</pre>
 <h3>
  <a name="TOC-Find-PDB-for-DEMO-Tablespace">
  </a>
  Find PDB for DEMO Tablespace
 </h3>
 <p>
  The defect in the above Data Recovery Advisor advice is that it does not tell me which PDB is affected.
 </p>
 <p>
  I ran the following command under RMAN on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   JAR
  </span>
  database instance:
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px">report schema;
</pre>
 <p>
  The result is:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Report of database schema for database with db_unique_name JAR

List of Permanent Datafiles
===========================
File Size(MB) Tablespace           RB segs Datafile Name
---- -------- -------------------- ------- ------------------------
1    800      SYSTEM               YES     /opt/app/oracle/oradata/JAR/datafile/o1_mf_system_c7k509cg_.dbf
2    257      PDB$SEED:SYSTEM      NO      /opt/app/oracle/oradata/JAR/277260DAB302A56EE0539801A8C03709/datafile/o1_mf_system_c7k50cqy_.dbf
3    1100     SYSAUX               NO      /opt/app/oracle/oradata/JAR/datafile/o1_mf_sysaux_c7k50j9r_.dbf
4    646      PDB$SEED:SYSAUX      NO      /opt/app/oracle/oradata/JAR/277260DAB302A56EE0539801A8C03709/datafile/o1_mf_sysaux_c7k50l5p_.dbf
5    690      UNDOTBS1             YES     /opt/app/oracle/oradata/JAR/datafile/o1_mf_undotbs1_c7k50n4t_.dbf
6    100      USERS                NO      /opt/app/oracle/oradata/JAR/datafile/o1_mf_users_c7k50ojv_.dbf
7    100      PDB$SEED:USERS       NO      /opt/app/oracle/oradata/JAR/277260DAB302A56EE0539801A8C03709/datafile/o1_mf_users_c7k50qgq_.dbf
11   281      PLUM:SYSTEM          NO      /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_system_c7kqc77v_.dbf
12   672      PLUM:SYSAUX          NO      /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_sysaux_c7kqc77w_.dbf
13   100      PLUM:USERS           NO      /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_users_c7kqc77w_.dbf
14   257      JAM:SYSTEM           NO      /opt/app/oracle/oradata/JAR/56F0DC7FE8D5154FE0539801A8C063F1/datafile/o1_mf_system_dsbsd9l5_.dbf
15   663      JAM:SYSAUX           NO      /opt/app/oracle/oradata/JAR/56F0DC7FE8D5154FE0539801A8C063F1/datafile/o1_mf_sysaux_dsbsd9lj_.dbf
16   100      JAM:USERS            NO      /opt/app/oracle/oradata/JAR/56F0DC7FE8D5154FE0539801A8C063F1/datafile/o1_mf_users_dsbsd9lk_.dbf
<span style="font-weight:bold">18   0        PLUM:DEMO            NO      /opt/app/oracle/oradata/transport/o1_mf_demo_fg8ssf96_.dbf</span>

List of Temporary Files
=======================
File Size(MB) Tablespace           Maxsize(MB) Tempfile Name
---- -------- -------------------- ----------- --------------------
1    100      TEMP                 33554431    /opt/app/oracle/oradata/JAR/datafile/o1_mf_temp_c7k50nrv_.tmp
2    100      PDB$SEED:TEMP        33554431    /opt/app/oracle/oradata/JAR/277260DAB302A56EE0539801A8C03709/datafile/o1_mf_temp_c7k50o4m_.tmp
3    100      PLUM:TEMP            33554431    /opt/app/oracle/oradata/JAR/2776C0571F0BCEF9E0539801A8C04CE1/datafile/o1_mf_temp_c7kqc77w_.dbf
4    100      JAM:TEMP             33554431    /opt/app/oracle/oradata/JAR/56F0DC7FE8D5154FE0539801A8C063F1/datafile/o1_mf_temp_dsbsd9lk_.dbf
</pre>
 <p>
  Scanning through the output, the relevant line is:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">18   0        PLUM:DEMO            NO      /opt/app/oracle/oradata/transport/o1_mf_demo_fg8ssf96_.dbf
</pre>
 <p>
  Thus, the
  <span style="font-family:monospace;background-color:#f2f2f2">
   DEMO
  </span>
  tablespace in the
  <span style="font-family:monospace;background-color:#f2f2f2">
   PLUM
  </span>
  pluggable database needs to be dropped.
 </p>
 <h3>
  <a name="TOC-Drop-DEMO-Tablespace-in-PLUM-PDB">
  </a>
  Drop DEMO Tablespace in PLUM PDB
 </h3>
 <p>
  For the RMAN issue reported above, the Data Recovery Advisor advised that we should fix the issue manually. I ran the following command under SQLPLUS on the
  <span style="font-family:monospace;background-color:#f2f2f2">
   PLUM
  </span>
  pluggable database:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">SQL&gt; alter pluggable database plum open;

Pluggable database altered.

SQL&gt; drop tablespace demo including contents;

Tablespace dropped.
</pre>
 <h3>
  <a name="TOC-Verify-No-Further-RMAN-Issues-Exist">
  </a>
  Verify No Further RMAN Issues Exist
 </h3>
 <p>
  Used the following RMAN command to check for any further RMAN issues:
 </p>
 <pre style="background-color:lawngreen;border:5px groove black;margin-left:10px;padding:2px"><a href="https://docs.oracle.com/database/121/RCMRF/rcmsynta027.htm#GUID-2BAB704C-A3C9-4F76-8D96-4BD961FBEF2E" rel="nofollow">list failure</a>;
</pre>
 <p>
  The result is:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px;padding:2px">Database Role: PRIMARY

no failures found that match specification
</pre>
 <p>
  As expected, there are no further issues.
 </p>
 <h2>
  <a name="TOC-Using-OEM-12C">
  </a>
  Using OEM 12C
 </h2>
 <p>
  As I am still studying for my OCM 12C, I have not upgraded my OMS to 13C yet.
 </p>
 <h3>
  <a name="TOC-Access-Advisor-Central">
  </a>
  Access Advisor Central
 </h3>
 <p>
  From the database home page in OEM, access the
  <cite>
   Advisor Central
  </cite>
  in the
  <cite>
   Performance
  </cite>
  menu as shown below:
 </p>
 <div style="display:block;text-align:left">
  <img border="0" src="home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration/detect-and-repair-data-failures-with-data-recovery-advisor/dra_oem_01.png"/>
 </div>
 <br/>
 <h3>
  <a name="TOC-Access-Data-Recovery-Advisor">
  </a>
  Access Data Recovery Advisor
 </h3>
 <p>
  The Data Recovery Advisor (DRA) is accessed as follows from the
  <cite>
   Advisor Central
  </cite>
  page:
 </p>
 <div style="display:block;text-align:left">
  <img border="0" src="home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration/detect-and-repair-data-failures-with-data-recovery-advisor/dra_oem_02.png"/>
 </div>
 <br/>
 <h3>
  <a name="TOC-View-and-Manage-Failures">
  </a>
  View and Manage Failures
 </h3>
 <p>
  There are currently no failures as can be seen below:
 </p>
 <div style="display:block;text-align:left">
  <img border="0" src="home/12c-ocp-upgrade/section-2-key-dba-skills/core-administration/detect-and-repair-data-failures-with-data-recovery-advisor/dra_oem_03.png"/>
 </div>
 <br/>
</div>
