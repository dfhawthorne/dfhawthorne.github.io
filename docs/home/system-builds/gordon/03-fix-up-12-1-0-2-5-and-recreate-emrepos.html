---
layout: default
title: '03 Fix Up 12.1.0.2.5 and Recreate EMREPOS'
base-url: home/system-builds/gordon/03-fix-up-12-1-0-2-5-and-recreate-emrepos.html
breadcrumbs:
- title: 'Home'
  url: index.html
- title: 'System Builds'
  url: home/system-builds.html
- title: 'GORDON'
  url: home/system-builds/gordon.html
- title: '03 Fix Up 12.1.0.2.5 and Recreate EMREPOS'
  url: home/system-builds/gordon/03-fix-up-12-1-0-2-5-and-recreate-emrepos.html
scroll-bar:
  left-link:
    url: home/system-builds/gordon/02-create-emrepos-database-using-dbca.html
    title: '02 Create EMREPOS Database Using DBCA'
  right-link:
    url: home/system-builds/gordon/04-install-oem-agent.html
    title: '04 Install OEM Agent'
table-of-contents:
- toc-url: 'Overview'
  toc-text: 'Overview'
- toc-url: 'References'
  toc-text: 'References'
- toc-url: 'Procedure'
  toc-text: 'Procedure'
  toc-menu:
  - toc-url: 'Drop-EMREPOS-Database'
    toc-text: 'Drop EMREPOS Database'
  - toc-url: 'Uninstall-RDBMS-12.1.0.2-Software'
    toc-text: 'Uninstall RDBMS 12.1.0.2 Software'
  - toc-url: 'Install-RDBMS-12.1.0.2-Software'
    toc-text: 'Install RDBMS 12.1.0.2 Software'
  - toc-url: 'Update-OPATCH'
    toc-text: 'Update OPATCH'
  - toc-url: 'Set-Up-Patching-Environment'
    toc-text: 'Set Up Patching Environment'
  - toc-url: 'Apply-PSU-12.1.0.2.5'
    toc-text: 'Apply PSU 12.1.0.2.5'
  - toc-url: 'Create-EMREPOS-Using-DBCA'
    toc-text: 'Create EMREPOS Using DBCA'
  - toc-url: 'Continue-with-PSU-Post-Installation'
    toc-text: 'Continue with PSU Post-Installation'
  - toc-url: 'Manual-Repair'
    toc-text: 'Manual Repair'
---
<div dir="ltr">
 <br/>
 <h2>
  <a name="TOC-Overview">
  </a>
  Overview
 </h2>
 <p>
  With the failure of the
  <code>
   dbca
  </code>
  command to complete correctly (as described in
  <a href="home/system-builds/gordon/02-create-emrepos-database-using-dbca.html">
   02 Create EMREPOS Database Using DBCA
  </a>
  , I decided to:
 </p>
 <ol>
  <li>
   Drop the
   <span style="font-family:monospace">
    EMREPOS
   </span>
   database
  </li>
  <li>
   Uninstall the Oracle RDBMS 12.1.0.2 software on
   <span style="font-family:monospace">
    GORDON
   </span>
  </li>
  <li>
   Install the Oracle RDBMS 12.1.0.2 software on
   <span style="font-family:monospace">
    GORDON
   </span>
  </li>
  <li>
   Apply the 12.1.0.2.5 PSU for RDBMS and OJVM again
  </li>
 </ol>
 <h2>
  <a name="TOC-References">
  </a>
  References
 </h2>
 <ul>
  <li>
   <a href="https://yaocm.wordpress.com/2015/05/31/a-better-way-of-dropping-databases-through-rman/" rel="nofollow">
    A Better Way of Dropping Databases Through RMAN
   </a>
  </li>
  <li>
   <a href="home/procedures/deinstall-oracle-rdbms/deinstall-oracle-rdbms-12-1-0-2.html">
    Deinstall Oracle RDBMS 12.1.0.2
   </a>
  </li>
  <li>
   <a href="home/procedures/install-oracle-rdbms/install-oracle-rdbms-12-1-0-2-with-grid-infrastructure.html">
    Install Oracle RDBMS 12.1.0.2 With Grid Infrastructure
   </a>
  </li>
  <li>
   <a href="https://updates.oracle.com/Orion/Services/download?type=readme&amp;aru=19361790" rel="nofollow">
    Patch 21555660 - Oracle JavaVM Component 12.1.0.2.5 Database PSU (Oct2015)
   </a>
  </li>
  <li>
   <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html">
    01 Patch GI and DB with PSU 12.1.0.2.5
   </a>
  </li>
  <ul>
   <li>
    <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Apply-DB-PSU">
     6 Apply DB PSU
    </a>
   </li>
   <li>
    <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Apply-OJVM-PSU">
     7 Apply OJVM PSU
    </a>
   </li>
   <li>
    <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Post-Installation-Steps">
     8 Post-Installation Steps
    </a>
   </li>
  </ul>
  <li>
   <a href="home/system-builds/gordon/02-create-emrepos-database-using-dbca.html">
    02 Create EMREPOS Database Using DBCA
   </a>
  </li>
 </ul>
 <h2>
  <a name="TOC-Procedure">
  </a>
  Procedure
 </h2>
 <h3>
  <a name="TOC-Drop-EMREPOS-Database">
  </a>
  Drop EMREPOS Database
 </h3>
 <p>
  Followed the procedure in
  <a href="https://yaocm.wordpress.com/2015/05/31/a-better-way-of-dropping-databases-through-rman/" rel="nofollow">
   A Better Way of Dropping Databases Through RMAN
  </a>
  to drop the
  <span style="font-family:monospace">
   EMREPOS
  </span>
  database.
 </p>
 <h3>
  <a name="TOC-Uninstall-RDBMS-12.1.0.2-Software">
  </a>
  Uninstall RDBMS 12.1.0.2 Software
 </h3>
 <p>
  Followed the procedure in
  <a href="home/procedures/deinstall-oracle-rdbms/deinstall-oracle-rdbms-12-1-0-2.html">
   Deinstall Oracle RDBMS 12.1.0.2
  </a>
  .
 </p>
 <h3>
  <a name="TOC-Install-RDBMS-12.1.0.2-Software">
  </a>
  Install RDBMS 12.1.0.2 Software
 </h3>
 <p>
  Followed the procedure in
  <a href="home/procedures/install-oracle-rdbms/install-oracle-rdbms-12-1-0-2-with-grid-infrastructure.html">
   Install Oracle RDBMS 12.1.0.2 With Grid Infrastructure
  </a>
  .
 </p>
 <h3>
  <a name="TOC-Update-OPATCH">
  </a>
  Update OPATCH
 </h3>
 <p>
  Used the following command to update
  <code>
   opatch
  </code>
  as the OUI installed an obsolete version:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">unzip -o /tmp/p6880880_121010_Linux-x86-64.zip -d /opt/app/oracle/product/12.1.0/dbhome_1
</pre>
 <h3>
  <a name="TOC-Set-Up-Patching-Environment">
  </a>
  Set Up Patching Environment
 </h3>
 <p>
  Since
  <code>
   opatch
  </code>
  uses
  <code>
   perl
  </code>
  , I need to set up the patching environment as follows:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">export ORACLE_HOME=/opt/app/oracle/product/12.1.0/dbhome_1
export PATH=${ORACLE_HOME}/OPatch:${ORACLE_HOME}/perl:${PATH}
export PERL5LIB=${ORACLE_HOME}/perl/lib
</pre>
 <h3>
  <a name="TOC-Apply-PSU-12.1.0.2.5">
  </a>
  Apply PSU 12.1.0.2.5
 </h3>
 <p>
  Followed the following steps in
  <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html">
   01 Patch GI and DB with PSU 12.1.0.2.5
  </a>
  to apply PSU 12.1.0.2.5 to RDBMS and OJVM:
 </p>
 <ol>
  <li>
   <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Apply-DB-PSU">
    6 Apply DB PSU
   </a>
  </li>
  <li>
   <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Apply-OJVM-PSU">
    7 Apply OJVM PSU
   </a>
  </li>
  <li>
   <a href="home/system-builds/gordon/01-patch-gi-and-db-with-psu-12-1-0-2-5.html#TOC-Post-Installation-Steps">
    8 Post-Installation Steps
   </a>
  </li>
 </ol>
 <p>
  In brief, the commands wer:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">opatch apply -ocmrf /opt/app/oracle/software/ocm.rsp /opt/app/oracle/software/patches/P21359755/21359755/ -silent
opatch apply -ocmrf /opt/app/oracle/software/ocm.rsp -silent /opt/app/oracle/software/patches/P21555660/21555660/
</pre>
 <p>
  This completed without incident.
 </p>
 <h3>
  <a name="TOC-Create-EMREPOS-Using-DBCA">
  </a>
  Create EMREPOS Using DBCA
 </h3>
 <p>
  Repeated the procedure in
  <a href="home/system-builds/gordon/02-create-emrepos-database-using-dbca.html">
   02 Create EMREPOS Database Using DBCA
  </a>
  .
 </p>
 <p>
  And got the same error!
 </p>
 <h3>
  <a name="TOC-Continue-with-PSU-Post-Installation">
  </a>
  Continue with PSU Post-Installation
 </h3>
 <p>
  Since the container database appeared to be usable, I decided to proceed with the PSU Post-Installation step.
 </p>
 <p>
  Created a temporary parameter file based on the value found in the alert log:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">cat &gt;/tmp/initrepos.ora &lt;&lt;DONE
spfile='+DATA/EMREPOS/PARAMETERFILE/spfile.258.900009511'
DONE
</pre>
 <p>
  Following the post-installation instructions in
  <a href="https://updates.oracle.com/Orion/Services/download?type=readme&amp;aru=19361790" rel="nofollow">
   Patch 21555660 - Oracle JavaVM Component 12.1.0.2.5 Database PSU (Oct2015)
  </a>
  , I set up the environment as follows:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">export ORACLE_SID=emrepos
export ORACLE_HOME=/opt/app/oracle/product/12.1.0/dbhome_1
export PATH=${ORACLE_HOME}/bin:${ORACLE_HOME}/OPatch:${PATH}
sqlplus / as sysdba
</pre>
 <p>
  Then I ran the following SQL*Plus commands:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">startup upgrade pfile='/tmp/initrepos.ora'
alter pluggable database all open upgrade;
quit
</pre>
 <p>
  The data patching was invoked through:
 </p>
 <pre style="background-color:Lawngreen;border:5px groove black;margin-left:10px">datapatch -verbose
</pre>
 <p>
  The log was:
 </p>
 <pre style="background-color:aqua;border:5px groove black;margin-left:10px">SQL Patching tool version 12.1.0.2.0 on Fri Jan  1 19:32:44 2016
Copyright (c) 2015, Oracle.  All rights reserved.

Log file for this invocation: /opt/app/oracle/cfgtoollogs/sqlpatch/sqlpatch_25545_2016_01_01_19_32_45/sqlpatch_invocation.log

Connecting to database...OK
Note:  Datapatch will only apply or rollback SQL fixes for PDBs
       that are in an open state, no patches will be applied to closed PDBs.
       Please refer to Note: Datapatch: Database 12c Post Patch SQL Automation
       (Doc ID 1585822.1)
Bootstrapping registry and package to current versions...done
Determining current state...done

Current state of SQL patches:
Patch 21555660 (Database PSU 12.1.0.2.5, Oracle JavaVM Component (Oct2015)):
  Installed in the binary registry only
Bundle series PSU:
  ID 5 in the binary registry and not installed in any PDB

Adding patches to installation queue and performing prereq checks...
Installation queue:
  For the following PDBs: CDB$ROOT PDB$SEED
    Nothing to roll back
    The following patches will be applied:
      21555660 (Database PSU 12.1.0.2.5, Oracle JavaVM Component (Oct2015))
      21359755 (Database Patch Set Update : 12.1.0.2.5 (21359755))

Installing patches...
Patch installation complete.  Total patches installed: 4

Validating logfiles...
Patch 21555660 apply (pdb CDB$ROOT): SUCCESS
  logfile: /opt/app/oracle/cfgtoollogs/sqlpatch/21555660/19361790/21555660_apply_EMREPOS_CDBROOT_2016Jan01_19_33_59.log (no errors)
Patch 21359755 apply (pdb CDB$ROOT): SUCCESS
  logfile: /opt/app/oracle/cfgtoollogs/sqlpatch/21359755/19194568/21359755_apply_EMREPOS_CDBROOT_2016Jan01_19_34_10.log (no errors)
Patch 21555660 apply (pdb PDB$SEED): SUCCESS
  logfile: /opt/app/oracle/cfgtoollogs/sqlpatch/21555660/19361790/21555660_apply_EMREPOS_PDBSEED_2016Jan01_19_34_37.log (no errors)
Patch 21359755 apply (pdb PDB$SEED): SUCCESS
  logfile: /opt/app/oracle/cfgtoollogs/sqlpatch/21359755/19194568/21359755_apply_EMREPOS_PDBSEED_2016Jan01_19_34_42.log (no errors)
SQL Patching tool complete on Fri Jan  1 19:34:59 2016
</pre>
 <p>
  Then the database instance was shutdown.
 </p>
 <h3>
  <a name="TOC-Manual-Repair">
  </a>
  Manual Repair
 </h3>
 <p>
  Followed the
  <a href="home/system-builds/gordon/02-create-emrepos-database-using-dbca.html#TOC-Manual-Repair">
   manual repair
  </a>
  section of
  <a href="home/system-builds/gordon/02-create-emrepos-database-using-dbca.html">
   02 Create EMREPOS Database Using DBCA
  </a>
  to fix up the GI resources and other things.
 </p>
</div>
