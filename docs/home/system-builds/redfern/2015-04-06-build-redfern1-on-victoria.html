---
layout: default
title: '2015-04-06 Build REDFERN1 on Victoria'
base-url: home/system-builds/redfern/2015-04-06-build-redfern1-on-victoria.html
breadcrumbs:
- title: 'Home'
  url: home.html
- title: 'System Builds'
  url: home/system-builds.html
- title: 'REDFERN'
  url: home/system-builds/redfern.html
- title: '2015-04-06 Build REDFERN1 on Victoria'
  url: home/system-builds/redfern/2015-04-06-build-redfern1-on-victoria.html
scroll-bar:
  left-link:
    url: home/system-builds/redfern/2015-04-04-create-redfern1-with-oel7.html
    title: '2015-04-04 Create REDFERN1 with OEL7'
  right-link:
    url: home/system-builds/redfern/2015-04-06-build-redfern2-on-victoria.html
    title: '2015-04-06 Build REDFERN2 on Victoria'
table-of-contents:
- toc-url: 'Overview'
  toc-text: 'Overview'
- toc-url: 'References'
  toc-text: 'References'
- toc-url: 'New-Design'
  toc-text: 'New Design'
  toc-menu:
  - toc-url: 'ASM-Disk-Groups'
    toc-text: 'ASM Disk Groups'
- toc-url: 'Procedure'
  toc-text: 'Procedure'
  toc-menu:
  - toc-url: 'Create-XEN-Directories'
    toc-text: 'Create XEN Directories'
  - toc-url: 'Create-Local-ASM-Disks'
    toc-text: 'Create Local ASM Disks'
  - toc-url: 'Create-Local-Disk-for-REDFERN1'
    toc-text: 'Create Local Disk for REDFERN1'
  - toc-url: 'Create-XEN-Configuration-File-for-REDFERN1'
    toc-text: 'Create XEN Configuration File for REDFERN1'
  - toc-url: 'Start-REDFERN1-VM-First-Time-'
    toc-text: 'Start REDFERN1 VM (First Time)'
  - toc-url: 'Disable-XEND'
    toc-text: 'Disable XEND'
  - toc-url: 'Install-OEL7-on-REDFERN1'
    toc-text: 'Install OEL7 on REDFERN1'
  - toc-url: 'Remove-Installation-DVD-from-VM'
    toc-text: 'Remove Installation DVD from VM'
  - toc-url: 'Verify-Network-Configuration'
    toc-text: 'Verify Network Configuration'
  - toc-url: 'Complete-Network-Configuration'
    toc-text: 'Complete Network Configuration'
---

<!-- {% raw %} -->
<div dir="ltr">


<br/>
<h2>
<a name="TOC-Overview">
</a>
                    Overview
                   </h2>
<p>
                    After the failure to use iSCSI with ReadyNAS, I eventually decided to try using XEN with local shared files. To this end, I set up
                    <span style="font-family:monospace">
                     VICTORIA
                    </span>
                    as follows:
                   </p>
<ul>
<li>
<a href="home/system-builds/victoria/2015-03-29-install-ovms-3-3-1.html">
                      Install OVMS 3.3.1
                     </a>
</li>
<li>
<a href="home/system-builds/victoria/2015-04-01-set-up-ovs-file-system.html">
                      Set Up OVS File System
                     </a>
</li>
<li>
<a href="home/system-builds/victoria/2015-04-04-set-up-xen-network.html">
                      Set Up XEN Network
                     </a>
</li>
</ul>
<h2>
<a name="TOC-References">
</a>
                    References
                   </h2>
<ul>
<li>
<a href="http://wiki.xen.org/wiki/Main_Page" rel="nofollow">
                      Xen Project Wiki
                     </a>
</li>
<ul>
<li>
<a href="http://xenbits.xen.org/docs/4.2-testing/misc/xl-disk-configuration.txt" rel="nofollow">
                       xl-disk-configuration.txt
                      </a>
</li>
<li>
<a href="http://xenbits.xen.org/docs/4.2-testing/misc/xl-network-configuration.html" rel="nofollow">
                       XL Network Configuration
                      </a>
</li>
<li>
<a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">
                       xl
                      </a>
</li>
<li>
<a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.cfg.5.html" rel="nofollow">
                       xl.cfg
                      </a>
</li>
<li>
<a href="http://wiki.xen.org/wiki/Category:Manual" rel="nofollow">
                       Category:Manual
                      </a>
</li>
<ul>
<li>
<a href="http://wiki.xenproject.org/wiki/Xen_Networking" rel="nofollow">
                        Xen Networking
                       </a>
</li>
<ul>
<li>
<a href="http://wiki.xenproject.org/wiki/Xen_Networking#Bridging" rel="nofollow">
                         3 Bridging
                        </a>
</li>
<ul>
<li>
<a href="http://wiki.xenproject.org/wiki/Xen_Networking#Attaching_virtual_devices_to_the_appropriate_bridge" rel="nofollow">
                          3.2 Attaching virtual devices to the appropriate bridge
                         </a>
</li>
</ul>
</ul>
</ul>
</ul>
<li>
<a href="http://man7.org/index.html" rel="nofollow">
                      Michael Kerrisk - man7.org
                     </a>
</li>
<ul>
<li>
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">
<span style="font-family:monospace">
                        dd
                       </span>
</a>
</li>
<li>
<a href="http://man7.org/linux/man-pages/man1/ls.1.html" rel="nofollow">
<span style="font-family:monospace">
                        ls
                       </span>
</a>
</li>
<li>
<a href="http://man7.org/linux/man-pages/man1/mkdir.1.html" rel="nofollow">
<span style="font-family:monospace">
                        mkdir
                       </span>
</a>
</li>
<a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">
<span style="font-family:monospace">
                       ping
                      </span>
</a>
<li>
<a href="http://man7.org/linux/man-pages/man1/printf.1.html" rel="nofollow">
<span style="font-family:monospace">
                        printf
                       </span>
</a>
</li>
<li>
<a href="http://man7.org/linux/man-pages/man1/uuidgen.1.html" rel="nofollow">
<span style="font-family:monospace">
                        uuidgen
                       </span>
</a>
</li>
</ul>
</ul>
<h2>
<a name="TOC-New-Design">
</a>
                    New Design
                   </h2>
<p>
                    There are two (2) changes to the design presented in
                    <a href="home/system-builds/redfern/2014-12-23-planning.html">
                     Planning
                    </a>
                    :
                   </p>
<ol>
<li>
                     Operating System will be OEL7 (64-bit) on XEN
                    </li>
<li>
                     ASM Disk Groups will be on local file system on
                     <span style="font-family:monospace">
                      VICTORIA
                     </span>
</li>
</ol>
<h3>
<a name="TOC-ASM-Disk-Groups">
</a>
                    ASM Disk Groups
                   </h3>
<table border="1">
<thead>
<tr>
<th>
                       Disk Group Name
                      </th>
<th>
                       Redundancy
                      </th>
<th>
                       Access
                      </th>
<th>
                       Location
                      </th>
<th>
                       Size (GB)
                      </th>
</tr>
</thead>
<tbody style="font-family:monospace">
<tr>
<td>
                       +DATA
                      </td>
<td>
                       External
                      </td>
<td>
                       Local
                      </td>
<td>
                       /OVS/running_pool/REDFERN/shared/DATA_01
                      </td>
<td align="right">
                       50
                      </td>
</tr>
<tr>
<td>
                       +FRA
                      </td>
<td>
                       External
                      </td>
<td>
                       Local
                      </td>
<td>
                       /OVS/running_pool/REDFERN/shared/FRA_01
                      </td>
<td align="right">
                       75
                      </td>
</tr>
<tr>
<td>
                       +REDO1
                      </td>
<td>
                       External
                      </td>
<td>
                       Local
                      </td>
<td>
                       /OVS/running_pool/REDFERN/shared/REDO1_01
                      </td>
<td align="right">
                       5
                      </td>
</tr>
<tr>
<td>
                       +REDO2
                      </td>
<td>
                       External
                      </td>
<td>
                       Local
                      </td>
<td>
                       /OVS/running_pool/REDFERN/shared/REDO2_01
                      </td>
<td align="right">
                       5
                      </td>
</tr>
<tr>
<td>
                       +VOTE
                      </td>
<td>
                       External
                      </td>
<td>
                       Local
                      </td>
<td>
                       /OVS/running_pool/REDFERN/shared/VOTE_01
                      </td>
<td align="right">
                       5
                      </td>
</tr>
</tbody>
</table>
<h2>
<a name="TOC-Procedure">
</a>
                    Procedure
                   </h2>
<h3>
<a name="TOC-Create-XEN-Directories">
</a>
                    Create XEN Directories
                   </h3>
<p>
                    Used the following command to create the directories on
                    <span style="font-family:monospace">
                     VICTORIA
                    </span>
                    :
                   </p>
<pre><a href="http://man7.org/linux/man-pages/man1/mkdir.1.html" rel="nofollow">mkdir</a> -p /OVS/running_pool/REDFERN/shared
<a href="http://man7.org/linux/man-pages/man1/mkdir.1.html" rel="nofollow">mkdir</a> -p /OVS/running_pool/REDFERN/redfern1
<a href="http://man7.org/linux/man-pages/man1/mkdir.1.html" rel="nofollow">mkdir</a> -p /OVS/running_pool/REDFERN/redfern2
</pre>
<h3>
<a name="TOC-Create-Local-ASM-Disks">
</a>
                    Create Local ASM Disks
                   </h3>
<p>
                    Created the required ASM disks as follows:
                   </p>
<pre><a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=50 if=/dev/zero of=/OVS/running_pool/REDFERN/shared/DATA_01 &amp;
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=75 if=/dev/zero of=/OVS/running_pool/REDFERN/shared/FRA_01 &amp;
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=5 if=/dev/zero of=/OVS/running_pool/REDFERN/shared/REDO1_01 &amp;
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=5 if=/dev/zero of=/OVS/running_pool/REDFERN/shared/REDO2_01 &amp;
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=5 if=/dev/zero of=/OVS/running_pool/REDFERN/shared/VOTE_01 &amp;
</pre>
<p>
                    After a while, I can confirm the files have been created successfully:
                   </p>
<pre>[root@victoria network-scripts]# <a href="http://man7.org/linux/man-pages/man1/ls.1.html" rel="nofollow">ls</a> -lh /OVS/running_pool/REDFERN/shared
total 186G
-rw-r--r-- 1 root root  50G Apr  4 13:59 DATA_01
-rw-r--r-- 1 root root  75G Apr  4 14:14 FRA_01
-rw-r--r-- 1 root root 5.0G Apr  4 12:14 REDO1_01
-rw-r--r-- 1 root root 5.0G Apr  4 12:16 REDO2_01
-rw-r--r-- 1 root root 5.0G Apr  4 16:51 VOTE_01
</pre>
<p>
<span style="font-weight:bold">
                     Note:
                    </span>
<span style="font-family:monospace">
<a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">
                      dd
                     </a>
</span>
                    did not fail with
                    <span style="font-family:monospace">
                     bs=1G
                    </span>
                    as it did in
                    <a href="home/system-builds/revesby/03-set-up-shared-disks-for-rac.html">
                     Set Up Shared Disks for RAC
                    </a>
                    for
                    <span style="font-family:monospace">
<a href="home/system-builds/revesby.html">
                      REVESBY
                     </a>
</span>
                    .
                   </p>
<h3>
<a name="TOC-Create-Local-Disk-for-REDFERN1">
</a>
                    Create Local Disk for REDFERN1
                   </h3>
<p>
                    To be on the safe side, I created a 50G disk for use by the operating system for
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    as follows:
                   </p>
<pre><a href="http://man7.org/linux/man-pages/man1/dd.1.html" rel="nofollow">dd</a> bs=1G count=50 if=/dev/zero of=/OVS/running_pool/REDFERN/redfern1/root_disk &amp;
</pre>
<h3>
<a name="TOC-Create-XEN-Configuration-File-for-REDFERN1">
</a>
                    Create XEN Configuration File for REDFERN1
                   </h3>
<p>
                    I used the examples in
                    <a href="http://wiki.xenproject.org/wiki/Xen_Networking#Attaching_virtual_devices_to_the_appropriate_bridge" rel="nofollow">
                     3.2 Attaching virtual devices to the appropriate bridge
                    </a>
                    and the documentation in
                    <a href="http://xenbits.xen.org/docs/4.2-testing/misc/xl-network-configuration.html" rel="nofollow">
                     XL Network Configuration
                    </a>
                    to construct the entries for
                    <span style="font-family:monospace;font-weight:bold">
                     VIF
                    </span>
                    using the allocated values from
                    <a href="home/resource-allocations/victoria-vm-resources.html">
                     Victoria VM Resources
                    </a>
                    .
                   </p>
<p>
                    The description of the entries for the
                    <span style="font-family:monospace;font-weight:bold">
                     DISK
                    </span>
                    parameter can be found in
                    <a href="http://xenbits.xen.org/docs/4.2-testing/misc/xl-disk-configuration.txt" rel="nofollow">
                     xl-disk-configuration.txt
                    </a>
                    .
                   </p>
<p>
                    The other options are described in
                    <a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.cfg.5.html" rel="nofollow">
                     xl.cfg
                    </a>
                    .
                   </p>
<pre>cd /OVS/running_pool/REDFERN/redfern1
cat &lt;&lt;DONE &gt;redfern1.hvm
# =====================================================================
# HVM guest configuration for REDFERN1
# Generated $(date +"%F %T")
# =====================================================================
#
# This is a fairly minimal example of what is required for an
# HVM guest. For a more complete guide see xl.cfg(5)
# This configures an HVM rather than PV guest
builder = "hvm"

# Guest name
name = "redfern1"

# 128-bit UUID for the domain as a hexadecimal number.
# Use "uuidgen" to generate one if required.
uuid = "$(<a href="http://man7.org/linux/man-pages/man1/uuidgen.1.html" rel="nofollow">uuidgen</a>)"

# Initial memory allocation (MB)
memory = 4096

# Number of VCPUS
vcpus = 2

# Network devices
# A list of 'vifspec' entries as described in
# docs/misc/xl-network-configuration.markdown
vif = [
    'mac=00:16:3E:00:00:0E,bridge=xenbr0',
    'mac=00:16:3E:00:00:0F,bridge=xenbr1',
    'mac=00:16:3E:00:00:10,bridge=xenbr2',
    'mac=00:16:3E:00:00:11,bridge=xenbr3'
    ]

# Disk Devices
# A list of 'diskspec' entries as described in
# docs/misc/xl-disk-configuration.txt
disk = [
    '/OVS/running_pool/REDFERN/redfern1/root_disk,raw,xvda,rw',
    '/OVS/iso_pool/V46135-01.iso,raw,xvdc,ro,cdrom',
    '/OVS/running_pool/REDFERN/shared/DATA_01,raw,xvdd,rw',
    '/OVS/running_pool/REDFERN/shared/FRA_01,raw,xvde,rw',
    '/OVS/running_pool/REDFERN/shared/REDO1_01,raw,xvdf,rw',
    '/OVS/running_pool/REDFERN/shared/REDO2_01,raw,xvdg,rw',
    '/OVS/running_pool/REDFERN/shared/VOTE_01,raw,xvdh,rw'
    ]

# Guest VGA console configuration, either SDL or VNC
vnc = 1
vnclisten = "0.0.0.0"
vncdisplay = "3"
DONE
</pre>
<h3>
<a name="TOC-Start-REDFERN1-VM-First-Time-">
</a>
                    Start REDFERN1 VM (First Time)
                   </h3>
<p>
                    When I try to start the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM, I get the following error:
                   </p>
<pre>[root@victoria redfern1]# <a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> create redfern1.hvm
xend is running, which may cause unpredictable results when using
this xl command.  Please shut down xend before continuing.

(This check can be overridden with the -f option.)
</pre>
<h3>
<a name="TOC-Disable-XEND">
</a>
                    Disable XEND
                   </h3>
<p>
                    I used the following commands to disable
                    <span style="font-family:monospace">
                     XEND
                    </span>
                    permanently:
                   </p>
<pre>service xend stop
chkconfig xend off
</pre>
<h3>
<a name="TOC-Install-OEL7-on-REDFERN1">
</a>
                    Install OEL7 on REDFERN1
                   </h3>
<p>
                    Started the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM again with the following command:
                   </p>
<pre><a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> create redfern1.hvm
</pre>
<p>
                    The output is:
                   </p>
<pre>Parsing config from redfern1.hvm
xc: info: VIRTUAL MEMORY ARRANGEMENT:
  Loader:        0000000000100000-&gt;000000000019cbe4
  Modules:       0000000000000000-&gt;0000000000000000
  TOTAL:         0000000000000000-&gt;00000000ff800000
  ENTRY ADDRESS: 0000000000100000
xc: info: PHYSICAL MEMORY ALLOCATION:
  4KB PAGES: 0x0000000000000200
  2MB PAGES: 0x00000000000003fb
  1GB PAGES: 0x0000000000000002
Daemon running with PID 9853
</pre>
<p>
                    Verified the running status as follows:
                   </p>
<pre>[root@victoria redfern1]# <a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> list
Name                                        ID   Mem VCPUs	State	Time(s)
Domain-0                                     0  1102     8     r-----    5501.2
redfern1                                     3  3840     2     -b----     247.3
</pre>
<p>
                    Used a VNCViewer (Remmina on Ubuntu) to connect to 192.168.1.100 and installed OEL 7. It was a minimal installation with
                    <span style="font-weight:bold">
                     NO
                    </span>
                    NICs configured.
                   </p>
<p>
                    At the end of the installation, I tried to eject the DVD via xl, but got the following error:
                   </p>
<pre>[root@victoria redfern1]# <a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> cd-eject 3 xvdc
libxl: error: libxl_qmp.c:289:qmp_handle_error_response: received an error message from QMP server: Device 'ide-51744' is locked
</pre>
<p>
                    3 was the current domain id for the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM.
                   </p>
<p>
                    I had to use the
                    <cite>
                     Reboot
                    </cite>
                    on the installer to reboot the system. The default boot device search order is disk then cd-rom. A successful installation would then choose the disk.
                   </p>
<p>
                    Once the system came up, I shut the VM down gracefully through:
                   </p>
<pre><a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> shutdown 4
</pre>
<p>
                    4 was the current domain id for the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM.
                   </p>
<h3>
<a name="TOC-Remove-Installation-DVD-from-VM">
</a>
                    Remove Installation DVD from VM
                   </h3>
<p>
                    I editted the
                    <span style="font-family:monospace">
                     redfern1.hvm
                    </span>
                    to remove the following line:
                   </p>
<pre>    '/OVS/iso_pool/V46135-01.iso,raw,xvdc,ro,cdrom',
</pre>
<h3>
<a name="TOC-Verify-Network-Configuration">
</a>
                    Verify Network Configuration
                   </h3>
<p>
                    Used the following command to verify the network configuration of the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM:
                   </p>
<pre><a href="http://xenbits.xen.org/docs/4.2-testing/man/xl.1.html" rel="nofollow">xl</a> network-list 7
</pre>
<p>
                    7 was the current domain id for the
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    VM.
                   </p>
<p>
                    The output should be similar to:
                   </p>
<pre>Idx BE Mac Addr.         handle state evt-ch   tx-/rx-ring-ref BE-path                       
0   0  00:16:3e:00:00:0e     0     4     -1   372/373         /local/domain/0/backend/vif/7/0
1   0  00:16:3e:00:00:0f     1     4     -1   374/375         /local/domain/0/backend/vif/7/1
2   0  00:16:3e:00:00:10     2     4     -1   376/377         /local/domain/0/backend/vif/7/2
3   0  00:16:3e:00:00:11     3     4     -1   378/379         /local/domain/0/backend/vif/7/3
</pre>
<h3>
<a name="TOC-Complete-Network-Configuration">
</a>
                    Complete Network Configuration
                   </h3>
<p>
                    Using the example in
                    <a href="home/system-builds/victoria/2015-04-04-set-up-xen-network.html">
                     07 Set Up XEN Network
                    </a>
                    , I ran the following script, on
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    , to populate the device descriptions for the four (4) Ethernet NICs:
                   </p>
<pre>cd /etc/sysconfig/network-scripts
for iface in 0 1 2 3
do
nw=$(((iface + 1)))
nic=$(((14 + iface)))
ifacename=eth${iface}
uuid=$(<a href="http://man7.org/linux/man-pages/man1/uuidgen.1.html" rel="nofollow">uuidgen</a>)
hwaddr=$(<a href="http://man7.org/linux/man-pages/man1/printf.1.html" rel="nofollow">printf</a> "00:16:3e:00:00:%0.2X" ${nic})
# ==== Create Interface
cat &lt;&lt;DONE &gt;ifcfg-${ifacename}
# -----------------------------------------------------------------------------
# NIC ${ifacename}
# Generated $(date +"%F %T")
# -----------------------------------------------------------------------------
# Device identification
DEVICE="${ifacename}"
UUID="${uuid}"
HWADDR="${hwaddr}"
# Device options
BOOTPROTO="static"
TYPE="Ethernet"
ONBOOT="yes"
DELAY="0"
NM_CONTROLLED="no"
# IPV4 Networking
IPADDR="192.168.${nw}.140"
NETMASK="255.255.255.0"
GATEWAY="192.168.1.1"
# DNS
DNS1="192.168.1.252"
DNS2="192.168.1.1"
PEERDNS="yes"
DOMAIN="yaocm.id.au"
DONE
done
</pre>
<p>
                    Then I brought this NICs up as follows:
                   </p>
<pre>ifup eth0
ifup eth1
ifup eth2
ifup eth3
</pre>
<p>
<a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">
<span style="font-family:monospace">
                      ping
                     </span>
</a>
                    confirmed connectivity on both
                    <span style="font-family:monospace">
                     REDFERN1
                    </span>
                    and
                    <span style="font-family:monospace">
                     VICTORIA
                    </span>
                    :
                   </p>
<pre><a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">ping</a> -c 1 192.168.1.140
<a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">ping</a> -c 1 192.168.2.140
<a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">ping</a> -c 1 192.168.3.140
<a href="http://man7.org/linux/man-pages/man8/ping.8.html" rel="nofollow">ping</a> -c 1 192.168.4.140
</pre>

</div>
<!-- {% endraw %} -->
