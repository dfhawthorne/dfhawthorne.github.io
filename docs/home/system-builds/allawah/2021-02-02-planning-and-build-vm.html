---
layout: default
title: '2021-02-02 Planning and Build VM'
base-url: 'home/system-builds/allawah/2021-02-02-planning-and-build-vm.html'
breadcrumbs:
- title: 'Home'
  url: home.html
- title: 'System Builds'
  url: home/system-builds.html
- title: 'ALLAWAH'
  url: home/system-builds/allawah.html
table-of-contents:
- toc-url: 'planning'
  toc-text: 'Planning'
- toc-url: 'vm-configuration-file'
  toc-text: 'VM Configuration File'
- toc-url: 'set-host-name'
  toc-text: 'Set Host Name'
- toc-url: 'edit-network-settings'
  toc-text: 'Edit Network Settings'
  toc-menu:
  - toc-url: 'update-configuration-file'
    toc-text: 'Update Configuration File'
  - toc-url: 'restart-interface'
    toc-text: 'Restart Interface'
  - toc-url: 'validate-network-settings'
    toc-text: 'Validate Network Settings'
- toc-url: 'install-ansible'
  toc-text: 'Install Ansible'
- toc-url: 'verify-ansible-version'
  toc-text: 'Verify Ansible Version'
---

<h2 id="TOC-planning">Planning</h2>
<ul>
<li>IP Address: 192.168.1.123</li>
<li>MAC Address for ETH0: <span style="font-family: monospace;">00:16:3E:00:00:14</span></li>
<li>VNC console port: 23</li>
<li>O/S: Ubuntu 16.04</li>
</ul>
<p>The <a href="home/resource-allocations/ip-addresses">IP resources</a> and <a href="home/resource-allocations/victoria-vm-resources">VM resources</a> pages have been updated to reflect this.</p>
<h2 id="TOC-vm-configuration-file">VM Configuration File</h2>
<p>The configuration file, <span style="font-family: monospace;">allawah.cfg</span>, is created in the <span style="font-family: monospace;">/OVS/runningpool/ALLAWAH</span> directory on <span style="font-family: monospace;">VICTORIA</span>.</p>
<pre class="text"># =====================================================================
# Guest configuration for ALLAWAH
# Minimal CLI server for Ubuntu
# Generated 2021-02-02 12:42:00
# =====================================================================
#
# This is a fairly minimal example of what is required for an
# HVM guest. For a more complete guide see xl.cfg(5)
# This configures a HVM guest
builder="hvm"
# This configures a PV guest
# type="PV"
# bootloader="pygrub"

# Guest name
name = "allawah"

# Device model
device_model_version="qemu-xen"
vendor_device="xenserver"

# 128-bit UUID for the domain as a hexadecimal number.
# Use "uuidgen" to generate one if required.
uuid = "e3626fd7-1b30-4473-9c97-76fc69648c9e"

# Initial memory allocation (MB)
memory = 2050

# Number of VCPUS
vcpus = 1
pool  = "Client"

# Network devices
# A list of 'vifspec' entries as described in
# docs/misc/xl-network-configuration.markdown
vif = [
    'mac=00:16:3E:00:00:14,bridge=xenbr0'
    ]

# Disk Devices
# A list of 'diskspec' entries as described in
# docs/misc/xl-disk-configuration.txt
disk = [
     '/OVS/running_pool/ALLAWAH/root.dsk,raw,xvda,rw'
    ,'/OVS/iso_pool/ubuntu-16.04.3-server-amd64.iso,raw,xvdc,ro,cdrom'
    ]

# Guest VGA console configuration, either SDL or VNC
vnc = 1
vnclisten = "0.0.0.0"
vncdisplay = "23"

# Fix for full-screen cursor
usb=1
usbdevice=["tablet"]

# New Features in Xen 4.4.0
# always emulate
tsc_mode="default"
</pre>
<h2 id=TOC-set-host-name">Set Host Name</h2>
<p>Used the following command to set the host name:</p>
<pre class="bash-cmd">sudo hostnamectl set-hostname allawah.yaocm.id.au</pre>
<h2 id="TOC-edit-network-settings">Edit Network Settings</h2>
<p>The default setting for the main NIC (eth0) is to use DHCP. I need a static IP address because this is a server.</p>
<h3 id="TOC-update-configuration-file">Update Configuration File</h3>
<p>The network configuration file, <span style="font-family: monospace;">/etc/network/interfaces</span>, had the following changes made:</p>
<pre class="text"># The primary network interface
auto eth0
#iface eth0 inet dhcp
iface eth0 inet static
        address 192.168.1.123
        netmask 255.255.255.0
        gateway 192.168.1.1

dns-nameserver 192.168.1.252
dns-nameserver 192.168.1.1
dns-search yaocm.id.au
</pre>
<h3 id="TOC-restart-interface">Restart Interface</h3>
<p>Using the VNC connection, I issued the following commands:</p>
<pre class="bash-cmd">sudo ifdown eth0
sudo ifup eth0</pre>
<h3 id="TOC-validate-network-settings">Validate Network Settings</h3>
<p>The network settings were validated as follows:</p>
<pre class="text">root@allawah:~# ip addr show eth0
2: eth0: &lt;broadcast,multicast,up,lower_up&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:16:3e:00:00:14 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.123/24 brd 192.168.1.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe00:14/64 scope link 
       valid_lft forever preferred_lft forever
root@allawah:~# cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 192.168.1.252
nameserver 192.168.1.1
search yaocm.id.au
&lt;/broadcast,multicast,up,lower_up&gt;</pre>
<h2 id="TOC-install-ansible">Install Ansible</h2>
<p>Followed the procedure described in "<a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-ansible-on-ubuntu">Installing Ansible on Ubuntu</a>":</p>
<pre class="bash-cmd">sudo apt -y update
sudo apt -y install software-properties-common
sudo apt-add-repository --yes --update ppa:ansible/ansible
sudo apt -y install ansible
</pre>
<h2 id="TOC-verify-ansible-version">Verify Ansible Version</h2>
<pre class="text">root@allawah:~# ansible --version
ansible 2.9.17
  config file = /etc/ansible/ansible.cfg
  configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python2.7/dist-packages/ansible
  executable location = /usr/bin/ansible
  python version = 2.7.12 (default, Oct  5 2020, 13:56:01) [GCC 5.4.0 20160609]
</pre>
