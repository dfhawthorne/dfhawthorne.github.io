---
layout: default
title: 'Create SQL Plan baselines'
base-url: home/12c-ocm/data-and-performance-management/create-sql-plan-baselines.html
breadcrumbs:
- title: 'Home'
  url: home.html
- title: '12C OCM'
  url: home/12c-ocm.html
- title: 'Data and Performance Management'
  url: home/12c-ocm/data-and-performance-management.html
- title: 'Create SQL Plan baselines'
  url: home/12c-ocm/data-and-performance-management/create-sql-plan-baselines.html
table-of-contents:
- toc-url: 'Summary'
  toc-text: 'Summary'
- toc-url: 'References'
  toc-text: 'References'
- toc-url: 'Sample-Session-Using-SQL-Plus'
  toc-text: 'Sample Session Using SQL*Plus'
  toc-menu:
  - toc-url: 'Determine-Current-Parameter-Settings'
    toc-text: 'Determine Current Parameter Settings'
  - toc-url: 'Capture-All-SQL-Plan-Baselines'
    toc-text: 'Capture All SQL Plan Baselines'
  - toc-url: 'Generate-Some-Test-Plans'
    toc-text: 'Generate Some Test Plans'
  - toc-url: 'Check-To-See-If-Any-SQL-Plans-Were-Captured'
    toc-text: 'Check To See If Any SQL Plans Were Captured'
  - toc-url: 'After-Second-Sample-SQL-Execution'
    toc-text: 'After Second Sample SQL Execution'
  - toc-url: 'Create-Index-to-Improve-SQL-Plan'
    toc-text: 'Create Index to Improve SQL Plan'
- toc-url: 'Using-OEM'
  toc-text: 'Using OEM'
  toc-menu:
  - toc-url: 'Access-SQL-Plan-Control'
    toc-text: 'Access SQL Plan Control'
  - toc-url: 'Access-SQL-Plan-Baseline-Tab'
    toc-text: 'Access SQL Plan Baseline Tab'
  - toc-url: 'Captured-SQL-Plan-Baselines'
    toc-text: 'Captured SQL Plan Baselines'
  - toc-url: 'Finding-Sample-SQL-Plan-Baselines'
    toc-text: 'Finding Sample SQL Plan Baselines'
  - toc-url: 'Details-of-SQL-Plan-Baseline'
    toc-text: 'Details of SQL Plan Baseline'
- toc-url: 'Using-SQL-Tuning-Sets-to-Create-SQL-Plan-Baselines'
  toc-text: 'Using SQL Tuning Sets to Create SQL Plan Baselines'
---
<div dir="ltr">
 <br/>
 <h2>
  <a name="TOC-Summary">
  </a>
  Summary
 </h2>
 <p>
  SQL Plan Baselines can be:
 </p>
 <ul>
  <li>
   Created automatically by setting the
   <a href="https://docs.oracle.com/database/121/REFRN/GUID-A562069E-BD44-4ABB-A987-0A13078F4E90.htm#REFRN10292" rel="nofollow">
    optimizer_capture_sql_plan_baselines
   </a>
   initialisation parameter either at the CDB or PDB level;
  </li>
  <li>
   Created from a SQL Tuning Set (STS)
  </li>
  <li>
   Created from the Cursor Cache
  </li>
 </ul>
 <p>
  Each of these options can be done through OEM or SQL*Plus
 </p>
 <h2>
  <a name="TOC-References">
  </a>
  References
 </h2>
 <ul>
  <li>
   <a href="https://docs.oracle.com/database/121/TDPPT/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database 2 Day + Performance Tuning Guide
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/TDPPT/tdppt_sqltune.htm#GUID-6B386EC1-A58F-4CFC-AEFB-9F787A112396" rel="nofollow">
     12 Tuning SQL Statements
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/TDPPT/tdppt_sqltune.htm#GUID-5DDF477C-5169-4490-B98A-45EB0036488D" rel="nofollow">
      Managing SQL Plan Baselines
     </a>
    </li>
    <ul>
     <li>
      <a href="https://docs.oracle.com/database/121/TDPPT/tdppt_sqltune.htm#GUID-BD5C16D9-6940-4EA4-B891-AA314BEAA64A" rel="nofollow">
       Capturing SQL Plan Baselines Automatically
      </a>
     </li>
    </ul>
   </ul>
  </ul>
  <li>
   <a href="https://docs.oracle.com/database/121/TGSQL/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database SQL Tuning Guide
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#GUID-7024369A-F98D-48E4-921C-C899485C954F" rel="nofollow">
     23 Managing SQL Plan Baselines
    </a>
   </li>
   <ul>
    <li>
     <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#GUID-3D701147-1371-4604-8127-F9199EA0EDE0" rel="nofollow">
      Configuring SQL Plan Management
     </a>
    </li>
    <li>
     <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#GUID-C6AC4856-3C8C-42D8-A7FD-629974E98D36" rel="nofollow">
      Loading SQL Plan Baselines
     </a>
    </li>
    <li>
     <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#TGSQL653" rel="nofollow">
      Evolving SQL Plan Baselines Manually
     </a>
    </li>
    <ul>
     <li>
      <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#TGSQL94653" rel="nofollow">
       Managing an Evolve Task
      </a>
     </li>
    </ul>
   </ul>
  </ul>
  <li>
   <a href="https://docs.oracle.com/database/121/REFRN/toc.htm" rel="nofollow">
    Oracle
    <sup>
     ®
    </sup>
    12.1 Database Reference
   </a>
  </li>
  <ul>
   <li>
    <a href="https://docs.oracle.com/database/121/REFRN/GUID-A562069E-BD44-4ABB-A987-0A13078F4E90.htm#REFRN10292" rel="nofollow">
     optimizer_capture_sql_plan_baselines
    </a>
   </li>
   <li>
    <a href="https://docs.oracle.com/database/121/REFRN/GUID-6218A4B0-B8B9-416E-ADB6-3FFA70F412DA.htm#REFRN10293" rel="nofollow">
     optimizer_use_sql_plan_baselines
    </a>
   </li>
   <li>
    <a href="https://docs.oracle.com/database/121/REFRN/GUID-101D8477-5600-4659-9A3C-9528391E500D.htm#REFRN23714" rel="nofollow">
     DBA_SQL_PLAN_BASELINES
    </a>
   </li>
  </ul>
 </ul>
 <h2>
  <a name="TOC-Sample-Session-Using-SQL-Plus">
  </a>
  Sample Session Using SQL*Plus
 </h2>
 <p>
  This sample session is based on the tutorial described in “
  <a href="https://docs.oracle.com/database/121/TGSQL/tgsql_spm.htm#TGSQL94653" rel="nofollow">
   Managing an Evolve Task
  </a>
  ”.
 </p>
 <p>
  The scripts used can be found at
  <a href="https://github.com/dfhawthorne/sql-ocm12c/tree/master/Data%20and%20performance%20management/Create%20SQL%20Plan%20Baselines" rel="nofollow">
   sql-ocm12c/Data and performance management/Create SQL Plan Baselines/
  </a>
  GIT repository.
 </p>
 <h3>
  <a name="TOC-Determine-Current-Parameter-Settings">
  </a>
  Determine Current Parameter Settings
 </h3>
 <p>
  Used the following SQL*Plus command to show the relevant parameter settings for SQL Plan Baselines:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">show parameter sql_plan_baselines</pre>
 <p>
  The result was:
 </p>
 <pre style="background-color:lightblue;border:5px groove black;margin-left:10px;padding:2px">NAME                    TYPE    VALUE
------------------------------------ ----------- ------------------------------
<a href="https://docs.oracle.com/database/121/REFRN/GUID-A562069E-BD44-4ABB-A987-0A13078F4E90.htm#REFRN10292" rel="nofollow">optimizer_capture_sql_plan_baselines</a> boolean     FALSE
<a href="https://docs.oracle.com/database/121/REFRN/GUID-6218A4B0-B8B9-416E-ADB6-3FFA70F412DA.htm#REFRN10293" rel="nofollow">optimizer_use_sql_plan_baselines</a>     boolean     TRUE
</pre>
 <h3>
  <a name="TOC-Capture-All-SQL-Plan-Baselines">
  </a>
  Capture All SQL Plan Baselines
 </h3>
 <p>
  Used the following SQL*Plus command to capture all SQL Plan Baselines:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">alter system set <a href="https://docs.oracle.com/database/121/REFRN/GUID-A562069E-BD44-4ABB-A987-0A13078F4E90.htm#REFRN10292" rel="nofollow">optimizer_capture_sql_plan_baselines</a>=true</pre>
 <h3>
  <a name="TOC-Generate-Some-Test-Plans">
  </a>
  Generate Some Test Plans
 </h3>
 <p>
  Used the following SQL*Plus command to run SQL in the SH schema of the EXAMPLES PDB:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">alter session set container=examples;
alter session set current_schema=sh;
</pre>
 <p>
  Used the following SQL as the sample:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">SELECT /* q1_group_by */ prod_name, sum(quantity_sold)
  FROM   products p, sales s
  WHERE  p.prod_id = s.prod_id
  AND    p.prod_category_id =203
  GROUP BY prod_name;
</pre>
 <h3>
  <a name="TOC-Check-To-See-If-Any-SQL-Plans-Were-Captured">
  </a>
  Check To See If Any SQL Plans Were Captured
 </h3>
 <p>
  Used the following SQL to confirm that no SQL plans were captured after just one (1) execution of the above sample SQL:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">SELECT SQL_HANDLE, SQL_TEXT, PLAN_NAME, ORIGIN, ENABLED, 
       ACCEPTED, FIXED, AUTOPURGE
FROM   <a href="https://docs.oracle.com/database/121/REFRN/GUID-101D8477-5600-4659-9A3C-9528391E500D.htm#REFRN23714" rel="nofollow">DBA_SQL_PLAN_BASELINES</a>
WHERE  SQL_TEXT LIKE '%q1_group%';
</pre>
 <p>
  The expected result is:
 </p>
 <pre style="background-color:lightblue;border:5px groove black;margin-left:10px;padding:2px">no rows selected
</pre>
 <h3>
  <a name="TOC-After-Second-Sample-SQL-Execution">
  </a>
  After Second Sample SQL Execution
 </h3>
 <p>
  After the second execution of the sample SQLDetermine Current Parameter Settings
 </p>
 <p>
  Used the following SQL*Plus commands to discover that the SQL plan was captured after the second execution of the above sample SQL:
 </p>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">SET PAGES 10000 LINES 140
SET SERVEROUTPUT ON
COL SQL_TEXT FORMAT A20
COL SQL_HANDLE FORMAT A20
COL PLAN_NAME FORMAT A30
COL ORIGIN FORMAT A12
SET LONGC 60535
SET LONG 60535
SET ECHO ON
SELECT SQL_HANDLE, SQL_TEXT, PLAN_NAME, ORIGIN, ENABLED, 
       ACCEPTED, FIXED, AUTOPURGE
FROM   <a href="https://docs.oracle.com/database/121/REFRN/GUID-101D8477-5600-4659-9A3C-9528391E500D.htm#REFRN23714" rel="nofollow">DBA_SQL_PLAN_BASELINES</a>
WHERE  SQL_TEXT LIKE '%q1_group%';
</pre>
 <p>
  The result is:
 </p>
 <pre style="background-color:lightblue;border:5px groove black;margin-left:10pxdetermine Current Parameter Settings;padding:2px">SQL_HANDLE           SQL_TEXT             PLAN_NAME                      ORIGIN       ENA ACC FIX
-------------------- -------------------- ------------------------------ ------------ --- --- ---
SQL_07f16c76ff893342 SELECT /* q1_group_b SQL_PLAN_0gwbcfvzskcu242949306 AUTO-CAPTURE YES YES NO
                     y */ prod_name, sum(
                     quantity_sold)
                      FROM   products p,
                      sales s
                       WHERE  p.prod_id =
                      s.prod_id
                       AND    p.prod_cate
                     gory_id =203
                       GROUP BY prod_name
</pre>
 <h3>
  <a name="TOC-Create-Index-to-Improve-SQL-Plan">
  </a>
  Create Index to Improve SQL Plan
 </h3>
 <pre style="background-color:lightgreen;border:5px groove black;margin-left:10px;padding:2px">CREATE INDEX ind_prod_cat_name 
  ON products(prod_category_id, prod_name, prod_id);<cite>SQL Plan Control</cite> page
CREATE INDEX ind_sales_prod_qty_sold 
  ON sales(prod_id, quantity_sold);
</pre>
 <p>
  The SQL Plans now include the following entries for the sample query:
 </p>
 <pre style="background-color:lightblue;border:5px groove black;margin-left:10px;padding:2px">SQL_HANDLE           SQL_TEXT             PLAN_NAME                      ORIGIN       ENA ACC FIX
-------------------- -------------------- ------------------------------ ------------ --- --- ---
SQL_07f16c76ff893342 SELECT /* q1_group_b SQL_PLAN_0gwbcfvzskcu242949306 AUTO-CAPTURE YES YES NO
                     y */ prod_name, sum(
                     quantity_sold)
                       FROM   products p,
                      sales s
                       WHERE  p.prod_id =
                      s.prod_id
                       AND    p.prod_cate
                     gory_id =203
                       GROUP BY prod_name

SQL_07f16c76ff893342 SELECT /* q1_group_b SQL_PLAN_0gwbcfvzskcu2ae9b4305 AUTO-CAPTURE YES NO  NO
                     y */ prod_name, sum(
                     quantity_sold)
                       FROM   products p,
                      sales s
                       WHERE  p.prod_id =
                      s.prod_id
                       AND    p.prod_cate
                     gory_id =203
                       GROUP BY prod_name

SQL_a8431fd849deb87e SELECT SQL_HANDLE, S SQL_PLAN_ahhszv14xxf3y6ded1a00 AUTO-CAPTURE YES YES NO
                     QL_TEXT, PLAN_NAME,
                        ORIGIN, ENABL
                     ED, ACCEPTED, FIXED
                     FROM   DBA_SQL_PLAN_
                     BASELINES
                     WHERE  SQL_TEXT LIKE
                      '%q1_group%'
</pre>
 <p>
  There are now two (2) SQL Plan Baselines for the sample query, and one (1) for the retrieval of the SQL Plan baselines.
 </p>
 <h2>
  <a name="TOC-Using-OEM">
  </a>
  Using OEM
 </h2>
 <h3>
  <a name="TOC-Access-SQL-Plan-Control">
  </a>
  Access SQL Plan Control
 </h3>
 <p>
  Access the SQL Plan Baselines by following the following pull-down menus on the database home page:
 </p>
 <ul>
  <li>
   <cite>
    Performance
   </cite>
   then
  </li>
  <ul>
   <li>
    <cite>
     SQL
    </cite>
    then
   </li>
   <ul>
    <li>
     Click on
     <cite>
      SQL Plan Control
     </cite>
    </li>
   </ul>
  </ul>
 </ul>
 <img alt="Database home page, then Performance, then SQL Plan Control" src="home/12c-ocm/data-and-performance-management/create-sql-plan-baselines/OEM_SQL_Plan_Control_Access.png"/>
 <p>
  You will be taken to the
  <cite>
   SQL Plan Control
  </cite>
  page.
 </p>
 <h3>
  <a name="TOC-Access-SQL-Plan-Baseline-Tab">
  </a>
  Access SQL Plan Baseline Tab
 </h3>
 <p>
  On the
  <cite>
   SQL Plan Control
  </cite>
  page, click on the
  <cite>
   SQL Plan Baseline
  </cite>
  tab:
 </p>
 <img alt="Access SQL Plan Baseline tab" src="home/12c-ocm/data-and-performance-management/create-sql-plan-baselines/OEM_SQL_Plan_Control_Landing_Page.png"/>
 <h3>
  <a name="TOC-Captured-SQL-Plan-Baselines">
  </a>
  Captured SQL Plan Baselines
 </h3>
 <p>
  You will note that the first two (2) settings correspond to the initialisation parameters that were examined about in
  <cite>
   Determine Current Parameter Settings
  </cite>
  .
 </p>
 <img alt="All captured SQL Plan Baselines" src="home/12c-ocm/data-and-performance-management/create-sql-plan-baselines/OEM_All_SQL_Plan_Baselines.png"/>
 <p>
  Since
  <a href="https://docs.oracle.com/database/121/REFRN/GUID-A562069E-BD44-4ABB-A987-0A13078F4E90.htm#REFRN10292" rel="nofollow" style="font-family:monospace">
   optimizer_capture_sql_plan_baselines
  </a>
  is enabled, you will note that all of the plans displayed have an origin of
  <span style="font-family:monospace;font-weight:bold">
   AUTO-CAPTURE
  </span>
  .
 </p>
 <h3>
  <a name="TOC-Finding-Sample-SQL-Plan-Baselines">
  </a>
  Finding Sample SQL Plan Baselines
 </h3>
 <p>
  In the
  <cite>
   SQL Text
  </cite>
  box under
  <cite>
   Search
  </cite>
  , I entered
  <cite>
   q1_group_by
  </cite>
  to locate all SQL Plan Baselines for the sample SQL I executed above. The result is:
 </p>
 <img alt="SQL Plan Baselines found for the sample SQL executed above" src="home/12c-ocm/data-and-performance-management/create-sql-plan-baselines/OEM_SQL_Plan_baselines_filtered.png"/>
 <h3>
  <a name="TOC-Details-of-SQL-Plan-Baseline">
  </a>
  Details of SQL Plan Baseline
 </h3>
 <p>
  Clicking on the first SQL Plan Baseline on the current page yields the following details of the SQL Plan Baseline.
 </p>
 <img src="home/12c-ocm/data-and-performance-management/create-sql-plan-baselines/OEM_SQL_Plan_baseline_sample.png"/>
 <h2>
  <a name="TOC-Using-SQL-Tuning-Sets-to-Create-SQL-Plan-Baselines">
  </a>
  Using SQL Tuning Sets to Create SQL Plan Baselines
 </h2>
 <p>
  I have created a shell script, called
  <a href="https://github.com/dfhawthorne/sql-ocm12c/blob/master/Data%20and%20performance%20management/Create%20SQL%20Plan%20Baselines/load_smb_from_sts.sh" rel="nofollow">
   load_smb_from_sts.sh
  </a>
  , which runs a simple scenario to:
 </p>
 <ol>
  <li>
   Disable automatic generation of SQL Plan Baselines
  </li>
  <li>
   Delete all existing SQL Plan Baselines
  </li>
  <li>
   Generate some execution plans
  </li>
  <li>
   Load these execution plans into a SQL Tuning Set (see
   <a href="https://github.com/dfhawthorne/sql-ocm12c/blob/master/Data%20and%20performance%20management/Create%20SQL%20Plan%20Baselines/load_smb_from_sts.sql" rel="nofollow">
    load_smb_from_sts.sql
   </a>
   ).
  </li>
 </ol>
</div>
