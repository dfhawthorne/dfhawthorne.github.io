---
layout: default
title: 'OMS Does Not Start After Server is on New Subnet'
base-url: home/11g-ocm/11g-ocm-system-builds/gridctrl/oms-does-not-start-after-server-is-on-new-subnet.html
breadcrumbs:
- title: 'Home'
  url: index.html
- title: '11G OCM'
  url: home/11g-ocm.html
- title: '11G OCM System Builds'
  url: home/11g-ocm/11g-ocm-system-builds.html
- title: 'GRIDCTRL'
  url: home/11g-ocm/11g-ocm-system-builds/gridctrl.html
- title: 'OMS Does Not Start After Server is on New Subnet'
  url: home/11g-ocm/11g-ocm-system-builds/gridctrl/oms-does-not-start-after-server-is-on-new-subnet.html
---
<div dir="ltr">
 <h3>
  <a name="TOC-References">
  </a>
  References
 </h3>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/toc.htm" rel="nofollow">
   Oracle速 Database Net Services Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul compact="compact">
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#i554826" rel="nofollow">
    Chapter 1, "Listener Control Utility"
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#CIHJHDDF" rel="nofollow">
     <code>
      lsnrctl services
     </code>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#CIHGHCGJ" rel="nofollow">
     <code>
      lsnrctl status
     </code>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/toc.htm" rel="nofollow">
   Oracle速 Database Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul compact="compact">
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams_part.htm#i200948" rel="nofollow">
    Part I Initialization Parameters
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams109.htm#i1128493" rel="nofollow">
     <code>
      LOCAL_LISTENER
     </code>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/toc.htm" rel="nofollow">
   Oracle速 Database SQL Language Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul compact="compact">
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_2013.htm#i2053602" rel="nofollow">
    <code>
     ALTER SYSTEM
    </code>
   </a>
  </li>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/toc.htm" rel="nofollow">
   Oracle速 Enterprise Manager Administration 10g Release 5 (10.2.0.5)
  </a>
 </p>
 <ul compact="compact">
  <li>
   <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#CHDEBABC" rel="nofollow">
    Chapter 8, "Starting and Stopping Enterprise Manager Components"
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#BABFEEAJ" rel="nofollow">
     Controlling the Oracle Management Service
    </a>
   </li>
   <ul compact="compact">
    <li>
     <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#BABCAFJJ" rel="nofollow">
      Controlling the Management Service on UNIX
     </a>
    </li>
    <ul compact="compact">
     <li>
      <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#BABCJIJH" rel="nofollow">
       Using emctl to Start, Stop, and Check the Status of the Oracle Management Service
      </a>
     </li>
    </ul>
   </ul>
  </ul>
 </ul>
 <p>
  <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/index.html" rel="nofollow">
   RHEL 5.0 Deployment Guide
  </a>
 </p>
 <ul compact="compact">
  <li>
   <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-network-config.html" rel="nofollow">
    Chapter 16. "Network Configuration"
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-network-config-hosts.html" rel="nofollow">
     16.9. Managing Hosts
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-services.html" rel="nofollow">
    Chapter 17. "Controlling Access to Services"
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-services-serviceconf.html" rel="nofollow">
     17.3. Services Configuration Tool
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/ch-bind.html" rel="nofollow">
    Chapter 18. "Berkeley Internet Name Domain (BIND)"
   </a>
  </li>
  <ul compact="compact">
   <li>
    <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-bind-namedconf.html" rel="nofollow">
     18.2. /etc/named.conf
    </a>
   </li>
   <li>
    <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-bind-zone.html" rel="nofollow">
     18.3. Zone Files
    </a>
   </li>
   <ul compact="compact">
    <li>
     <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s2-bind-configuration-zone-reverse.html" rel="nofollow">
      18.3.4. Reverse Name Resolution Zone Files
     </a>
    </li>
   </ul>
  </ul>
 </ul>
 <h3>
  <a name="TOC-Overview">
  </a>
  Overview
 </h3>
 <p>
  <code>
   GRIDCTRL
  </code>
  is having a problem of starting up OMS and OMA after I moved the server from the
  <code>
   10.1.1.0/24
  </code>
  subnet to
  <code>
   192.168.1.0/24
  </code>
  .
 </p>
 <p>
  The root cause was an entry in
  <code>
   /etc/hosts
  </code>
  pointing to the old subnet.
 </p>
 <h3>
  <a name="TOC-Review-of-Changes-Made">
  </a>
  Review of Changes Made
 </h3>
 <p>
  I updated the DNS files on
  <code>
   GRIDCTRL
  </code>
  to refer to the new subnet:
 </p>
 <ul compact="compact">
  <li>
   <code>
    /var/named/chroot/etc/named.conf
   </code>
  </li>
  <li>
   <code>
    /var/named/chroot/var/named/yaocm.id.au.rr.zone
   </code>
  </li>
  <li>
   <code>
    /var/named/chroot/var/named/yaocm.id.au.zone
   </code>
  </li>
 </ul>
 <p>
  The
  <code>
   named
  </code>
  service was restarted via the
  <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-services-serviceconf.html" rel="nofollow">
   Services Configuration Tool
  </a>
  .
 </p>
 <h3>
  <a name="TOC-Analysis">
  </a>
  Analysis
 </h3>
 <h4>
  <a name="TOC-Starting-OMS">
  </a>
  Starting OMS
 </h4>
 <p>
  When I tried to start OMS on
  <code>
   GRIDCTRL
  </code>
  (
  <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#BABCJIJH" rel="nofollow">
   Using emctl to Start, Stop, and Check the Status of the Oracle Management Service
  </a>
  ), I get the following messages:
 </p>
 <pre>[oracle@gridctrl ~]$ emctl start oms
Oracle Enterprise Manager 10g Release 5 Grid Control
Copyright (c) 1996, 2009 Oracle Corporation.  All rights reserved.
opmnctl: opmn is already running
Starting HTTP Server ...
Starting Oracle Management Server ...
Checking Oracle Management Server Status ...
Oracle Management Server is Down.
</pre>
 <h4>
  <a name="TOC-Review-Log">
  </a>
  Review Log
 </h4>
 <p>
  The following messages appearred in
  <code>
   /opt/oracle/app/OracleHomes/oms10g/sysman/log/emoms.trc
  </code>
  whenever the OMS tries to start:
 </p>
 <pre>2012-02-02 17:21:22,320 [Orion Launcher] WARN  jdbc.ConnectionCache _getConnection.352 - Io exception: The Network Adapter could not establish the connection
java.sql.SQLException: Io exception: The Network Adapter could not establish the connection
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:137)
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:174)
        at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError.java:286)
        at oracle.jdbc.driver.T4CConnection.logon(T4CConnection.java:332)
        at oracle.jdbc.driver.PhysicalConnection.(PhysicalConnection.java:429)
        at oracle.jdbc.driver.T4CConnection.(T4CConnection.java:152)
        at oracle.jdbc.driver.T4CDriverExtension.getConnection(T4CDriverExtension.java:31)
        at oracle.jdbc.driver.OracleDriver.connect(OracleDriver.java:608)
        at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:217)
        at oracle.jdbc.pool.OracleConnectionPoolDataSource.getPhysicalConnection(OracleConnectionPoolDataSource.java:113)
        at oracle.jdbc.pool.OracleConnectionPoolDataSource.getPooledConnection(OracleConnectionPoolDataSource.java:76)
        at oracle.jdbc.pool.OracleImplicitConnectionCache.makeCacheConnection(OracleImplicitConnectionCache.java:1361)
        at oracle.jdbc.pool.OracleImplicitConnectionCache.getCacheConnection(OracleImplicitConnectionCache.java:439)
        at oracle.jdbc.pool.OracleImplicitConnectionCache.getConnection(OracleImplicitConnectionCache.java:334)
        at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:285)
        at oracle.jdbc.pool.OracleDataSource.getConnection(OracleDataSource.java:253)
        at oracle.sysman.util.jdbc.ConnectionCache._getConnection(ConnectionCache.java:336)
        at oracle.sysman.util.jdbc.ConnectionCache._getConnection(ConnectionCache.java:322)
        at oracle.sysman.util.jdbc.ConnectionCache.getUnwrappedConnection(ConnectionCache.java:575)
        at oracle.sysman.emSDK.svc.conn.FGAConnectionCache.getFGAConnection(FGAConnectionCache.java:218)
        at oracle.sysman.emSDK.svc.conn.ConnectionService.getPrivateConnection(ConnectionService.java:1162)
        at oracle.sysman.emSDK.svc.conn.ConnectionService.getRepositoryVersionAndMode(ConnectionService.java:762)
        at oracle.sysman.emSDK.svc.conn.ConnectionService.verifyRepositoryEx(ConnectionService.java:840)
        at oracle.sysman.emSDK.svc.conn.ConnectionService.verifyRepository(ConnectionService.java:934)
        at oracle.sysman.eml.app.ContextInitializer.contextInitialized(ContextInitializer.java:301)
        at com.evermind.server.http.HttpApplication.initDynamic(HttpApplication.java:1020)
        at com.evermind.server.http.HttpApplication.(HttpApplication.java:560)
        at com.evermind.server.Application.getHttpApplication(Application.java:915)
        at com.evermind.server.http.HttpServer.getHttpApplication(HttpServer.java:707)
        at com.evermind.server.http.HttpSite.initApplications(HttpSite.java:637)
        at com.evermind.server.http.HttpSite.setConfig(HttpSite.java:278)
        at com.evermind.server.http.HttpServer.setSites(HttpServer.java:278)
        at com.evermind.server.http.HttpServer.setConfig(HttpServer.java:179)
        at com.evermind.server.ApplicationServer.initializeHttp(ApplicationServer.java:2435)
        at com.evermind.server.ApplicationServer.setConfig(ApplicationServer.java:1592)
        at com.evermind.server.ApplicationServerLauncher.run(ApplicationServerLauncher.java:92)
        at java.lang.Thread.run(Thread.java:534)
2012-02-02 17:21:22,709 [Orion Launcher] WARN  jdbc.ConnectionCache _getConnection.353 - Got a fatal exeption when getting a connection; Error code = 17002; Cleaning up cache and retrying
</pre>
 <h4>
  <a name="TOC-Check-the-Listener-Log">
  </a>
  Check the Listener Log
 </h4>
 <p>
  This looks like a problem of trying to connect to the repository database via the listener.
 </p>
 <h4>
  <a name="TOC-Listener-Logs-Not-in-ADR-Structure">
  </a>
  Listener Logs Not in ADR Structure
 </h4>
 <p>
  There are two (2) problems with the listener as shown by the output from the
  <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#CIHGHCGJ" rel="nofollow">
   <code>
    lsnrctl status
   </code>
  </a>
  command:
 </p>
 <ol compact="compact">
  <li>
   The logs are not in the right place for
   <code>
    adrci
   </code>
   ;
  </li>
  <li>
   The
   <code>
    repos
   </code>
   database instance is not registered with the listener.
  </li>
 </ol>
 <pre>[oracle@gridctrl ~]$ lsnrctl status

LSNRCTL for Linux: Version 11.1.0.7.0 - Production on 02-FEB-2012 10:34:01

Copyright (c) 1991, 2008, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 11.1.0.7.0 - Production
Start Date                02-FEB-2012 06:22:40
Uptime                    0 days 4 hr. 11 min. 21 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /opt/oracle/app/OracleHomes/db11g/network/admin/listener.ora
Listener Log File         /opt/oracle/app/OracleHomes/db11g/log/diag/tnslsnr/gridctrl/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=gridctrl.yaocm.id.au)(PORT=1521)))
Services Summary...
Service "PLSExtProc" has 1 instance(s).
  Instance "PLSExtProc", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully
</pre>
 <h5>
  <a name="TOC-Change-Location-of-Listener-Log">
  </a>
  Change Location of Listener Log
 </h5>
 <p>
  The problem with the location of the logs was fixed by adding the following line to
  <code>
   /opt/oracle/app/OracleHomes/db11g/install/unix/scripts/seedstup
  </code>
  :
 </p>
 <pre>export ORACLE_BASE=/opt/oracle/app
</pre>
 <p>
  After
  <code>
   GRIDCTRL
  </code>
  was restarted, the logs are now in the correct place for ADR as shown by the
  <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#CIHGHCGJ" rel="nofollow">
   <code>
    lsnrctl status
   </code>
  </a>
  command:
 </p>
 <pre>[oracle@gridctrl ~]$ lsnrctl status

LSNRCTL for Linux: Version 11.1.0.7.0 - Production on 02-FEB-2012 10:49:49

Copyright (c) 1991, 2008, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 11.1.0.7.0 - Production
Start Date                02-FEB-2012 10:42:34
Uptime                    0 days 0 hr. 7 min. 15 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /opt/oracle/app/OracleHomes/db11g/network/admin/listener.ora
Listener Log File         /opt/oracle/app/diag/tnslsnr/gridctrl/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=gridctrl.yaocm.id.au)(PORT=1521)))
Services Summary...
Service "PLSExtProc" has 1 instance(s).
  Instance "PLSExtProc", status UNKNOWN, has 1 handler(s) for this service...
The command completed successfully
</pre>
 <p>
  However, the listener log is not showing any connection errors.
 </p>
 <h5>
  <a name="TOC-Registering-Repository-Database-with-Listener">
  </a>
  Registering Repository Database with Listener
 </h5>
 <p>
  I hacked the
  <code>
   REPOS
  </code>
  database instance by using the
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams109.htm#i1128493" rel="nofollow">
   <code>
    LOCAL_LISTENER
   </code>
  </a>
  system parameter.
 </p>
 <p>
  <code>
   tnsnames.ora
  </code>
  contains the following entry:
 </p>
 <pre>REPOS =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC ))
    )
    (CONNECT_DATA =
      (SID = repos)
    )
  )
</pre>
 <p>
  Changed the system parameter as follows and registered the instance with the listener via the
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_2013.htm#i2053602" rel="nofollow">
   <code>
    ALTER SYSTEM
   </code>
  </a>
  command:
 </p>
 <pre>SQL&lt; alter system set local_listener='REPOS' scope=both;

System altered.

SQL&lt; alter system register;

System altered.
</pre>
 <p>
  The database instance is now registered with the listener as shown by the
  <a href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/lsnrctl.htm#CIHJHDDF" rel="nofollow">
   <code>
    lsnrctl services
   </code>
  </a>
  command:
 </p>
 <pre>LSNRCTL for Linux: Version 11.1.0.7.0 - Production on 02-FEB-2012 10:51:12

Copyright (c) 1991, 2008, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC)))
Services Summary...
Service "PLSExtProc" has 1 instance(s).
  Instance "PLSExtProc", status UNKNOWN, has 1 handler(s) for this service...
    Handler(s):
      "DEDICATED" established:0 refused:0
         LOCAL SERVER
Service "repos.yaocm.id.au" has 1 instance(s).
  Instance "repos", status READY, has 1 handler(s) for this service...
    Handler(s):
      "DEDICATED" established:0 refused:0 state:ready
         LOCAL SERVER
Service "repos_XPT.yaocm.id.au" has 1 instance(s).
  Instance "repos", status READY, has 1 handler(s) for this service...
    Handler(s):
      "DEDICATED" established:0 refused:0 state:ready
         LOCAL SERVER
The command completed successfully
</pre>
 <h4>
  <a name="TOC-Attempt-to-Start-OMS-Again">
  </a>
  Attempt to Start OMS Again
 </h4>
 <p>
  Even with the database service registered, the startup of OMS still fails.
 </p>
 <h3>
  <a name="TOC-Root-Cause-Identified">
  </a>
  Root Cause Identified
 </h3>
 <p>
  Did a google search using the phrase
  <a href="http://www.google.com.au/#sclient=psy-ab&amp;hl=en&amp;source=hp&amp;q=%22%5BOrion+Launcher%5D+WARN++jdbc.ConnectionCache+_getConnection.353+-+Got+a+fatal+exeption+when+getting+a+connection%3B+Error+code+%3D+17002%3B+Cleaning+up+cache+and+retrying%22&amp;pbx=1&amp;oq=%22%5BOrion+Launcher%5D+WARN++jdbc.ConnectionCache+_getConnection.353+-+Got+a+fatal+exeption+when+getting+a+connection%3B+Error+code+%3D+17002%3B+Cleaning+up+cache+and+retrying%22&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_sm=e&amp;gs_upl=1520l4178l0l4718l3l1l0l0l0l0l204l204l2-1l1l0&amp;bav=on.2,or.r_gc.r_pw.,cf.osb&amp;fp=35019d9fb59b80bf&amp;biw=1280&amp;bih=709">
   "[Orion Launcher] WARN  jdbc.ConnectionCache _getConnection.353 - Got a fatal exeption when getting a connection; Error code = 17002; Cleaning up cache and retrying"
  </a>
  and found a hint about
  <code>
   /etc/hosts
  </code>
  in
  <a href="http://software.itags.org/enterprise-application/23338/" rel="nofollow">
   Grid Control windows installation fails (Business &amp; Enterprise Application)
  </a>
  .
 </p>
 <p>
  Checked
  <code>
   /etc/hosts
  </code>
  on
  <code>
   GRIDCTRL
  </code>
  and found the problem in the following line:
 </p>
 <pre>10.1.1.252 gridctrl.yaocm.id.au gridctrl
</pre>
 <p>
  You really should use the
  <a href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-network-config-hosts.html" rel="nofollow">
   Managing Hosts
  </a>
  utility instead of editting the
  <code>
   /etc/hosts
  </code>
  directly.
 </p>
 <p>
  Changed this line to:
 </p>
 <pre>192.168.1.252 gridctrl.yaocm.id.au gridctrl
</pre>
 <p>
  And the startup of OMS was successful (
  <a href="http://docs.oracle.com/cd/B16240_01/doc/em.102/e14586/emctl.htm#BABCJIJH" rel="nofollow">
   Using emctl to Start, Stop, and Check the Status of the Oracle Management Service
  </a>
  ):
 </p>
 <pre>[oracle@gridctrl ~]$ emctl start oms
Oracle Enterprise Manager 10g Release 5 Grid Control
Copyright (c) 1996, 2009 Oracle Corporation.  All rights reserved.
opmnctl: opmn is already running
Starting HTTP Server ...
Starting Oracle Management Server ...
Checking Oracle Management Server Status ...
Oracle Management Server is Up.
</pre>
 <h3>
  <a name="TOC-Conclusion">
  </a>
  Conclusion
 </h3>
 <p>
  Although I had changed the DNS correctly, I forgot to check the
  <code>
   /etc/hosts
  </code>
  file for entries.
 </p>
 <p>
  The change to the
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/initparams109.htm#i1128493" rel="nofollow">
   <code>
    LOCAL_LISTENER
   </code>
  </a>
  parameter was unnecessary because the listener is using the default port of 1521. I have left it there in order to maintain the IPC backdoor.
 </p>
</div>
