---
layout: default
title: 11G OCM Replay a captured workload
base-url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload.html
breadcrumbs:
- title: Home
  url: home.html
- title: 11G OCM
  url: home/11g-ocm.html
- title: 11G OCM Performance Management
  url: home/11g-ocm/11g-ocm-performance-management.html
- title: 11G OCM Replay a captured workload
  url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload.html
table-of-contents:
- toc-url: References
  toc-text: References
- toc-url: Overview
  toc-text: Overview
- toc-url: Reading-Notes
  toc-text: Reading Notes
- toc-url: Procedure
  toc-text: Procedure
---
<div dir="ltr">
 <div>
  <div class="sites-embed-align-left-wrapping-off">
   <div class="sites-embed-border-off sites-embed sites-embed-full-width" style="width:100%;">
    <div class="sites-embed-content sites-embed-type-toc">
    </div>
   </div>
  </div>
 </div>
 <h3>
  <a name="TOC-1">
  </a>
  <br/>
 </h3>
 <h3>
  <a name="TOC-References">
  </a>
  References
 </h3>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/toc.htm" rel="nofollow">
   Oracle® Database Concepts 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/intro.htm#insertedID0" rel="nofollow">
    Chapter 1, "Introduction to Oracle Database"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/intro.htm#insertedID2" rel="nofollow">
     Oracle Database Features
    </a>
   </li>
   <ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/intro.htm#CEGGGAIC" rel="nofollow">
      Overview of Oracle Real Application Testing
     </a>
    </li>
    <ul>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/intro.htm#CEGFHHHJ" rel="nofollow">
       Database Replay
      </a>
     </li>
    </ul>
   </ul>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/toc.htm" rel="nofollow">
   Oracle® Database PL/SQL Packages and Types Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_lock.htm#insertedID0" rel="nofollow">
    Chapter 70, "DBMS_LOCK"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_lock.htm#i997212" rel="nofollow">
     <span style="font-family:monospace">
      SLEEP
     </span>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload.html">
   Oracle® Database Real Application Testing User's Guide 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID0" rel="nofollow">
    Chapter 2, "Introduction to Database Replay"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID1" rel="nofollow">
     Workload Capture
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID2" rel="nofollow">
     Workload Preprocessing
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID3" rel="nofollow">
     Workload Replay
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID4" rel="nofollow">
     Analysis and Reporting
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#CACICAAC" rel="nofollow">
    Chapter 3, "Capturing a Database Workload"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#insertedID2" rel="nofollow">
     Workload Capture Options
    </a>
   </li>
   <ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#CACHIAAA" rel="nofollow">
      Defining the Workload Filters
     </a>
    </li>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#CACBCAJE" rel="nofollow">
      Setting Up the Capture Directory
     </a>
    </li>
   </ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#insertedID5" rel="nofollow">
     Capturing a Database Workload Using Enterprise Manager
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_preprocess.htm#CHDHCAHI" rel="nofollow">
    Chapter 4, "Preprocessing a Database Workload"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_preprocess.htm#insertedID1" rel="nofollow">
     Preprocessing a Database Workload Using Enterprise Manager
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_replay.htm#CHDBCADJ" rel="nofollow">
    Chapter 5, "Replaying a Database Workload"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_replay.htm#CHDEBCIC" rel="nofollow">
     Replaying a Database Workload Using Enterprise Manager
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_analyze.htm#CACBHAEF" rel="nofollow">
    Chapter 6, "Analyzing Replayed Workload"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_analyze.htm#CACJDHBG" rel="nofollow">
     Generating a Workload Capture Report Using Enterprise Manager
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_analyze.htm#CACHABCB" rel="nofollow">
     Generating a Workload Replay Report Using Enterprise Manager
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/toc.htm" rel="nofollow">
   Oracle® Database SQL Language Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_5007.htm#i2061958" rel="nofollow">
    <span style="font-family:monospace">
     CREATE DIRECTORY
    </span>
   </a>
  </li>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_9013.htm#i2155015" rel="nofollow">
    <span style="font-family:monospace">
     GRANT
    </span>
   </a>
  </li>
 </ul>
 <h3>
  <a name="TOC-Overview">
  </a>
  Overview
 </h3>
 <p>
  The objective from the
  <a href="http://education.oracle.com/pls/web_prod-plq-dad/db_pages.getpage?page_id=41&amp;p_exam_id=11gOCMU#3" rel="nofollow">
   11G OCM Upgrade Exam
  </a>
  is:
 </p>
 <blockquote>
  Replay a captured workload
 </blockquote>
 <p>
  This involves the
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/intro.htm#CEGFHHHJ" rel="nofollow">
   Database Replay
  </a>
  feature:
 </p>
 <blockquote>
  Database Replay enables realistic testing of system changes by essentially re-creating the production workload environment on a test system. It does this by capturing a workload on the production system and then replaying it on a test system with the exact timing, concurrency, and transaction characteristics of the original workload. This makes possible complete assessment of the impact of the change including undesired results, new contention points, and performance regressions. Extensive analysis and reporting is provided to help identify any potential problems, such as new errors encountered and performance divergences.
 </blockquote>
 <p>
  This objective is also related to the following objective:
 </p>
 <ul>
  <li>
   <a href="home/11g-ocm/11g-ocm-data-guard/11g-ocm-convert-the-standby-to-a-snapshot-standby.html">
    Convert the standby to a snapshot standby
   </a>
  </li>
 </ul>
 <h3>
  <a name="TOC-Reading-Notes">
  </a>
  Reading Notes
 </h3>
 <h4>
  <a name="TOC-Workload-Capture">
  </a>
  Workload Capture
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID1" rel="nofollow">
   Workload Capture
  </a>
  is defined as:
 </p>
 <blockquote>
  <p>
   When workload capture is enabled, all external client requests directed to Oracle Database are tracked and stored in binary files—called capture files—on the file system. You can specify the location where the capture files will be stored.
  </p>
 </blockquote>
 <h4>
  <a name="TOC-Workload-Preprocessing">
  </a>
  Workload Preprocessing
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID2" rel="nofollow">
   Workload Preprocessing
  </a>
  is defined as:
 </p>
 <blockquote>
  <p>
   Preprocessing transforms the captured data into replay files and creates all necessary metadata needed for replaying the workload. This must be done once for every captured workload before they can be replayed.
  </p>
 </blockquote>
 <p>
  Workload Replay
 </p>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID3" rel="nofollow">
   Workload Replay
  </a>
  is defined as:
 </p>
 <blockquote>
  <p>
   During the workload replay phase, Oracle Database performs the actions recorded during the workload capture phase on the test system by re-creating all captured external client requests with the same timing, concurrency, and transaction dependencies of the production system.
  </p>
 </blockquote>
 <h4>
  <a name="TOC-Analysis-and-Reporting">
  </a>
  Analysis and Reporting
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_intro.htm#insertedID4" rel="nofollow">
   Analysis and Reporting
  </a>
  is defined as:
 </p>
 <blockquote>
  <p>
   The report summary provides basic information about the workload capture and replay, such as errors encountered during replay and data divergence in rows returned by DML or SQL queries. A comparison of several statistics—such as database time, average active sessions, and user calls—between the workload capture and the workload replay is also provided
  </p>
 </blockquote>
 <h4>
  <a name="TOC-Defining-the-Workload-Filters">
  </a>
  Defining the Workload Filters
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#CACHIAAA" rel="nofollow">
   Defining the Workload Filters
  </a>
  :
 </p>
 <blockquote>
  <p>
   By default, all user sessions are recorded during workload capture. You can use workload filters to specify which user sessions to include in or exclude from the workload. There are two types of workload filters: inclusion filters and exclusion filters. You can use either inclusion filters or exclusion filters in a workload capture, but not both.
  </p>
 </blockquote>
 <h4>
  <a name="TOC-Setting-Up-the-Capture-Directory">
  </a>
  Setting Up the Capture Directory
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#CACBCAJE" rel="nofollow">
   Setting Up the Capture Directory
  </a>
  :
 </p>
 <blockquote>
  <p>
   Determine the location and set up a directory where the captured workload will be stored. Before starting the workload capture, ensure that the directory is empty and has ample disk space to store the workload.
  </p>
 </blockquote>
 <h3>
  <a name="TOC-Procedure">
  </a>
  Procedure
 </h3>
 <p>
  I am going to set up a read-only workload to make my life easier as there is no need for backups and restores. I will use the sample schema,
  <span style="font-family:monospace">
   SH
  </span>
  .
 </p>
 <h4>
  <a name="TOC-Test-Query">
  </a>
  Test Query
 </h4>
 <p>
  The test query is as follows:
 </p>
 <pre>SELECT
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year,
    SUM( sales.quantity_sold )
      AS total_quantity_sold,
    SUM( sales.amount_sold )
      AS total_amount_sold
  FROM
      sales
    INNER JOIN
      products
    USING( prod_id )
    INNER JOIN
      customers
    USING( cust_id )
    INNER JOIN
      countries
    USING( country_id )
    INNER JOIN
      channels
    USING( channel_id )
    INNER JOIN
      times
    USING( time_id )
  WHERE
      products.prod_valid = 'A'
    AND
      channels.channel_class = 'Direct'
    AND
      customers.cust_valid = 'A'
    AND
      countries.country_name = 'Australia'
  GROUP BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
  ORDER BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
;
</pre>
 <p>
  This query is about a yearly summary of product categories and sub-categories sold directly to active customers in Australia.
 </p>
 <p>
  This query is saved in a file called
  <span style="font-family:monospace">
   sh_sales.sql
  </span>
  .
 </p>
 <h4>
  <a name="TOC-Simulating-Think-Time">
  </a>
  Simulating Think Time
 </h4>
 <p>
  I am going to simulate think time by using the
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_lock.htm#i997212" rel="nofollow">
   <span style="font-family:monospace">
    DBMS_LOCK.SLEEP
   </span>
  </a>
  procedure.  The user,
  <span style="font-family:monospace">
   SH
  </span>
  , needs
  <span style="font-family:monospace">
   EXECUTE
  </span>
  privilege on this procedure. This is achieved through the
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_9013.htm#i2155015" rel="nofollow">
   <span style="font-family:monospace">
    GRANT
   </span>
  </a>
  command on the package,
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_lock.htm#insertedID0" rel="nofollow">
   <span style="font-family:monospace">
    DBMS_LOCK
   </span>
  </a>
  , as follows:
 </p>
 <pre>GRANT EXECUTE ON dbms_lock TO sh;
</pre>
 <h4>
  <a name="TOC-Test-Wrapper-Script">
  </a>
  Test Wrapper Script
 </h4>
 <p>
  The test wrapper script executes the query three (3) times with a think time of five (5) seconds between each execution:
 </p>
 <pre>@@sh_sales
exec dbms_lock.sleep( 5 )
@@sh_sales
exec dbms_lock.sleep( 5 )
@@sh_sales
</pre>
 <h4>
  <a name="TOC-Workload-Capture1">
  </a>
  Workload Capture
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_capture.htm#insertedID5" rel="nofollow">
   Capturing a Database Workload Using Enterprise Manager
  </a>
  .
 </p>
 <p>
  Running with filter mode of inclusion:
 </p>
 <ul>
  <li>
   A filter called SH_USER is created for the user, SH.
  </li>
 </ul>
 <p>
  The directory is created as follows:
 </p>
 <blockquote style="font-family:monospace">
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_5007.htm#i2061958" rel="nofollow">
   CREATE DIRECTORY
  </a>
  "SH_REPLAY" AS '/u00/app/oracle/replay/sh';
 </blockquote>
 <p>
  A screenshot of the review of capture workload is as follows:
 </p>
 <img src="home/11g-ocm/11g-ocm-performance-management/review_capture_workload.png.html"/>
 <div style="display:block;text-align:left">
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_capture_workload.png%3Fattredirects=0" imageanchor="1">
   <img border="0" src="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_capture_workload.png"/>
  </a>
 </div>
 <p>
  The test wrapper script was run three (3) times on three (3) different terminals.
 </p>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_analyze.htm#CACJDHBG" rel="nofollow">
   Generating a Workload Capture Report Using Enterprise Manager
  </a>
  .
 </p>
 <p>
  The workload capture report is uploaded as
  <span style="font-family:monospace">
   workload_report_1329872485962.html
  </span>
  .
 </p>
 <h4>
  <a name="TOC-Preprocess-Captured-Workload">
  </a>
  Preprocess Captured Workload
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_preprocess.htm#insertedID1" rel="nofollow">
   Preprocessing a Database Workload Using Enterprise Manager
  </a>
  .
 </p>
 <p>
  A screenshot of the review of preprocess captured workload is as follows:
 </p>
 <img src="home/11g-ocm/11g-ocm-performance-management/review_preprocess_workload.png.html"/>
 <div style="display:block;text-align:left">
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_preprocess_workload.png%3Fattredirects=0" imageanchor="1">
   <img border="0" src="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_preprocess_workload.png"/>
  </a>
 </div>
 <h4>
  <a name="TOC-Replay-Workload">
  </a>
  Replay Workload
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_replay.htm#CHDEBCIC" rel="nofollow">
   Replaying a Database Workload Using Enterprise Manager
  </a>
  .
 </p>
 <p>
  The calibration says that only one (1) client needs to be used.
 </p>
 <p>
  A screenshot of the review of replay workload is as follows:
 </p>
 <img src="home/11g-ocm/11g-ocm-performance-management/review_replay_workload.png.html"/>
 <div style="display:block;text-align:left">
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_replay_workload.png%3Fattredirects=0" imageanchor="1">
   <img border="0" src="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload/review_replay_workload.png"/>
  </a>
 </div>
 <h4>
  <a name="TOC-Analyzing-Replayed-Workload">
  </a>
  Analyzing Replayed Workload
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/e12253/dbr_analyze.htm#CACHABCB" rel="nofollow">
   Generating a Workload Replay Report Using Enterprise Manager
  </a>
  .
 </p>
 <p>
  The Workload Replay report is uploaded as
  <span style="font-family:monospace">
   workload_report_1329885258683.html
  </span>
  .
 </p>
</div>
