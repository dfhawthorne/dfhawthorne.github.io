---
layout: default
title: '11G OCM Use SQL Tuning Advisor'
base-url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-tuning-advisor.html
breadcrumbs:
- title: 'Home'
  url: home.html
- title: '11G OCM'
  url: home/11g-ocm.html
- title: '11G OCM Performance Management'
  url: home/11g-ocm/11g-ocm-performance-management.html
- title: '11G OCM Use SQL Tuning Advisor'
  url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-tuning-advisor.html
table-of-contents:
- toc-url: References
  toc-text: References
- toc-url: Overview
  toc-text: Overview
- toc-url: Reading-Notes
  toc-text: Reading Notes
  toc-menu:
  - toc-url: SQL-Tuning-Advisor
    toc-text: SQL Tuning Advisor
  - toc-url: SQL-Tuning-Sets
    toc-text: SQL Tuning Sets
- toc-url: Test-Case
  toc-text: Test Case
  toc-menu:
  - toc-url: SQL-Tuning-Set
    toc-text: SQL Tuning Set
  - toc-url: Run-the-SQL-Tuning-Advisor
    toc-text: Run the SQL Tuning Advisor
    toc-menu:
    - toc-url: Creating-a-SQL-Tuning-Task
      toc-text: Creating a SQL Tuning Task
    - toc-url: Executing-a-SQL-Tuning-Task
      toc-text: Executing a SQL Tuning Task
    - toc-url: Checking-the-Status-of-a-SQL-Tuning-Task
      toc-text: Checking the Status of a SQL Tuning Task
    - toc-url: Checking-the-Progress-of-the-SQL-Tuning-Advisor
      toc-text: Checking the Progress of the SQL Tuning Advisor
    - toc-url: Displaying-the-Results-of-a-SQL-Tuning-Task
      toc-text: Displaying the Results of a SQL Tuning Task
---
<div dir="ltr">
 <br/>
 <h3>
  <a name="TOC-References">
  </a>
  References
 </h3>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/toc.htm" rel="nofollow">
   Oracle® Database Concepts 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID0" rel="nofollow">
    Chapter 14, "Manageability"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID4" rel="nofollow">
     Application and SQL Tuning
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/toc.htm" rel="nofollow">
   Oracle® Database Performance Tuning Guide 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#insertedID0" rel="nofollow">
    Chapter 17, "Automatic SQL Tuning"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#insertedID2" rel="nofollow">
     SQL Tuning Advisor
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#insertedID4" rel="nofollow">
     Reactive Tuning Using the SQL Tuning Advisor
    </a>
   </li>
   <ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#i34827" rel="nofollow">
      Running the SQL Tuning Advisor
     </a>
    </li>
    <ul>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDJDHGE" rel="nofollow">
       Creating a SQL Tuning Task
      </a>
     </li>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDGHAFB" rel="nofollow">
       Executing a SQL Tuning Task
      </a>
     </li>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDEHGBC" rel="nofollow">
       Checking the Status of a SQL Tuning Task
      </a>
     </li>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDECCCD" rel="nofollow">
       Checking the Progress of the SQL Tuning Advisor
      </a>
     </li>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDDGAEB" rel="nofollow">
       Displaying the Results of a SQL Tuning Task
      </a>
     </li>
    </ul>
   </ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#i34915" rel="nofollow">
     SQL Tuning Sets
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/toc.htm" rel="nofollow">
   Oracle® Database PL/SQL Packages and Types Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
    Chapter 125, "DBMS_SQLTUNE"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1006897" rel="nofollow">
     <span style="font-family:monospace">
      CREATE_SQLSET
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#CHDGBCDB" rel="nofollow">
     <span style="font-family:monospace">
      CREATE_TUNING_TASK
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#CHDGEJJA" rel="nofollow">
     <span style="font-family:monospace">
      EXECUTE_TUNING_TASK
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1006951" rel="nofollow">
     <span style="font-family:monospace">
      LOAD_SQLSET
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1010615" rel="nofollow">
     <span style="font-family:monospace">
      SELECT_CURSOR_CACHE
     </span>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/toc.htm" rel="nofollow">
   Oracle® Database Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_part.htm#i125539" rel="nofollow">
    Part II Static Data Dictionary Views
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_5195.htm#i1633167" rel="nofollow">
     <span style="font-family:monospace">
      USER_ADVISOR_TASKS
     </span>
    </a>
   </li>
  </ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/dynviews_part.htm#i403961" rel="nofollow">
    Part III Dynamic Performance Views
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/dynviews_1008.htm#I1030327" rel="nofollow">
     <span style="font-family:monospace">
      V$ADVISOR_PROGRESS
     </span>
    </a>
   </li>
  </ul>
 </ul>
 <h3>
  <a name="TOC-Overview">
  </a>
  Overview
 </h3>
 <p>
  The objective from the
  <a href="http://education.oracle.com/pls/web_prod-plq-dad/db_pages.getpage?page_id=41&amp;p_exam_id=11gOCMU#3" rel="nofollow">
   11G OCM Upgrade Exam
  </a>
  is:
 </p>
 <blockquote>
  Use SQL Tuning Advisor
 </blockquote>
 <h3>
  <a name="TOC-Reading-Notes">
  </a>
  Reading Notes
 </h3>
 <h4>
  <a name="TOC-SQL-Tuning-Advisor">
  </a>
  SQL Tuning Advisor
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID4" rel="nofollow">
   Application and SQL Tuning
  </a>
  says that:
 </p>
 <blockquote>
  <p>
   After identifying the top resource-consuming SQL statements, Oracle Database can automatically analyze them and recommend solutions using the Automatic SQL Tuning Advisor. Automatic SQL Tuning is exposed with an advisor, called the SQL Tuning Advisor. The SQL Tuning Advisor takes one or more SQL statements as input and produces well-tuned plans along with tuning advice. You do not need to do anything other than invoke the SQL Tuning Advisor.
  </p>
 </blockquote>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#insertedID2" rel="nofollow">
   SQL Tuning Advisor
  </a>
  is described thus:
 </p>
 <blockquote>
  <p>
   The SQL Tuning Advisor takes one or more SQL statements as an input and invokes the Automatic Tuning Optimizer to perform SQL tuning on the statements. The output of the SQL Tuning Advisor is in the form of an advice or recommendations, along with a rationale for each recommendation and its expected benefit. The recommendation relates to collection of statistics on objects, creation of new indexes, restructuring of the SQL statement, or creation of a SQL profile. You can choose to accept the recommendation to complete the tuning of the SQL statements.
  </p>
 </blockquote>
 <h4>
  <a name="TOC-SQL-Tuning-Sets">
  </a>
  SQL Tuning Sets
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#i34915" rel="nofollow">
   SQL Tuning Sets
  </a>
  are described thus:
 </p>
 <blockquote>
  <p>
   A SQL Tuning Set (STS) is a database object that includes one or more SQL statements along with their execution statistics and execution context, and could include a user priority ranking. The SQL statements can be loaded into a SQL Tuning Set from different SQL sources, such as the Automatic Workload Repository, the cursor cache, or custom SQL provided by the user. An STS includes:
  </p>
  <ul>
   <li>
    A set of SQL statements
   </li>
   <li>
    Associated execution context, such as user schema, application module name and action, list of bind values, and the cursor compilation environment
   </li>
   <li>
    Associated basic execution statistics, such as elapsed time, CPU time, buffer gets, disk reads, rows processed, cursor fetches, the number of executions, the number of complete executions, optimizer cost, and the command type
   </li>
   <li>
    Associated execution plans and row source statistics for each SQL statement (optional)
   </li>
  </ul>
 </blockquote>
 <h3>
  <a name="TOC-Test-Case">
  </a>
  Test Case
 </h3>
 <p>
  The test I am using is the SQL from
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload.html">
   Replay a captured workload
  </a>
  which has an SQL ID of 'dgdfqhj9ua2kv'.
 </p>
 <p>
  The test query is as follows:
 </p>
 <pre>SELECT
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year,
    SUM( sales.quantity_sold )
      AS total_quantity_sold,
    SUM( sales.amount_sold )
      AS total_amount_sold
  FROM
      sales
    INNER JOIN
      products
    USING( prod_id )
    INNER JOIN
      customers
    USING( cust_id )
    INNER JOIN
      countries
    USING( country_id )
    INNER JOIN
      channels
    USING( channel_id )
    INNER JOIN
      times
    USING( time_id )
  WHERE
      products.prod_valid = 'A'
    AND
      channels.channel_class = 'Direct'
    AND
      customers.cust_valid = 'A'
    AND
      countries.country_name = 'Australia'
  GROUP BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
  ORDER BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
;
</pre>
 <p>
  This query is about a yearly summary of product categories and sub-categories sold directly to active customers in Australia.
 </p>
 <h4>
  <a name="TOC-SQL-Tuning-Set">
  </a>
  SQL Tuning Set
 </h4>
 <p>
  I saved this SQL into a SQL Tuning Set called
  <span style="font-family:monospace">
   OCM11G
  </span>
  :
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1006897" rel="nofollow">
   CREATE_SQLSET
  </a>
  ( 'OCM11G' )
  <br/>
  DECLARE
  <br/>
  cur
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .SQLSET_CURSOR;
  <br/>
  BEGIN
  <br/>
  OPEN cur FOR
  <br/>
  SELECT VALUE(P)
  <br/>
  FROM table(
  <br/>
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1010615" rel="nofollow">
   SELECT_CURSOR_CACHE
  </a>
  (
  <br/>
  'sql_id = ''dgdfqhj9ua2kv''')) P;
  <br/>
  <br/>
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#i1006951" rel="nofollow">
   LOAD_SQLSET
  </a>
  (sqlset_name =&gt; 'OCM11G',
  <br/>
  populate_cursor =&gt; cur);
  <br/>
  <br/>
  END;
  <br/>
  /
  <br/>
 </blockquote>
 <h4>
  <a name="TOC-Run-the-SQL-Tuning-Advisor">
  </a>
  Run the SQL Tuning Advisor
 </h4>
 <h5>
  <a name="TOC-Creating-a-SQL-Tuning-Task">
  </a>
  Creating a SQL Tuning Task
 </h5>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDJDHGE" rel="nofollow">
   Creating a SQL Tuning Task
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  VARIABLE task_name VARCHAR2(30)
  <br/>
  EXEC :task_name :=
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#CHDGBCDB" rel="nofollow">
   CREATE_TUNING_TASK
  </a>
  ( sqlset_name =&gt; 'OCM11G' );
  <br/>
  PRINT task_name
  <br/>
 </blockquote>
 <p>
  The output is:
 </p>
 <table align="center" border="1">
  <tbody>
   <tr>
    <th>
     TASK_NAME
    </th>
   </tr>
   <tr>
    <td>
     TASK_296
    </td>
   </tr>
  </tbody>
 </table>
 <h5>
  <a name="TOC-Executing-a-SQL-Tuning-Task">
  </a>
  Executing a SQL Tuning Task
 </h5>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDGHAFB" rel="nofollow">
   Executing a SQL Tuning Task
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#insertedID0" rel="nofollow">
   DBMS_SQLTUNE
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_sqltun.htm#CHDGEJJA" rel="nofollow">
   EXECUTE_TUNING_TASK
  </a>
  ( task_name =&gt; 'TASK_296' );
 </blockquote>
 <h5>
  <a name="TOC-Checking-the-Status-of-a-SQL-Tuning-Task">
  </a>
  Checking the Status of a SQL Tuning Task
 </h5>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDEHGBC" rel="nofollow">
   Checking the Status of a SQL Tuning Task
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  SELECT status FROM
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_5195.htm#i1633167" rel="nofollow">
   USER_ADVISOR_TASKS
  </a>
  WHERE task_name = 'TASK_296';
 </blockquote>
 <p>
  The output is:
 </p>
 <table align="center" border="1">
  <tbody>
   <tr>
    <th>
     STATUS
    </th>
   </tr>
   <tr>
    <td>
     COMPLETED
    </td>
   </tr>
  </tbody>
 </table>
 <h5>
  <a name="TOC-Checking-the-Progress-of-the-SQL-Tuning-Advisor">
  </a>
  Checking the Progress of the SQL Tuning Advisor
 </h5>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDECCCD" rel="nofollow">
   Checking the Progress of the SQL Tuning Advisor
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  SELECT sofar, totalwork FROM
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/dynviews_1008.htm#I1030327" rel="nofollow">
   V$ADVISOR_PROGRESS
  </a>
  WHERE user_name = 'SYS' AND task_name = 'TASK_296';
 </blockquote>
 <p>
  The result is:
 </p>
 <blockquote style="font-family:monospace">
  SELECT sofar, totalwork FROM V$ADVISOR_PROGRESS WHERE user_name = 'SYS' AND task_name = 'TASK_296'
  <br/>
  *
  <br/>
  ERROR at line 1:
  <br/>
  <br/>
  ORA-00904: "TASK_NAME": invalid identifier
  <br/>
 </blockquote>
 <p>
  Also,
  <span style="font-family:monospace">
   USER_NAME
  </span>
  is an invalid identifier—it should be
  <span style="font-family:monospace">
   USERNAME
  </span>
  .
 </p>
 <h5>
  <a name="TOC-Displaying-the-Results-of-a-SQL-Tuning-Task">
  </a>
  Displaying the Results of a SQL Tuning Task
 </h5>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/sql_tune.htm#CHDDGAEB" rel="nofollow">
   Displaying the Results of a SQL Tuning Task
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  SET LONG 1000
  <br/>
  SET LONGCHUNKSIZE 1000
  <br/>
  SET LINESIZE 100
  <br/>
  SELECT DBMS_SQLTUNE.REPORT_TUNING_TASK( 'TASK_296')
  <br/>
  FROM DUAL;
  <br/>
 </blockquote>
 <p>
  And the result is:
 </p>
 <table align="center" border="1">
  <tbody>
   <tr>
    <th>
     DBMS_SQLTUNE.REPORT_TUNING_TASK('TASK_296')
    </th>
   </tr>
   <tr>
    <td style="font-family:monospace">
     GENERAL INFORMATION SECTION
     <br/>
     -------------------------------------------------------------------------------
     <br/>
     Tuning Task Name                  : TASK_296
     <br/>
     Tuning Task Owner                 : SYS
     <br/>
     Workload Type                     : SQL Tuning Set
     <br/>
     Scope                             : COMPREHENSIVE
     <br/>
     Time Limit(seconds)               : 1800
     <br/>
     Completion Status                 : COMPLETED
     <br/>
     Started at                        : 02/23/2012 03:49:06
     <br/>
     Completed at                      : 02/23/2012 03:51:07
     <br/>
     SQL Tuning Set (STS) Name         : OCM11G
     <br/>
     SQL Tuning Set Owner              : SYS
     <br/>
     Number of Statements in the STS   : 1
     <br/>
     -------------------------------------------------------------------------------
     <br/>
     There  are no recommendations to improve the statements in the workload.
     <br/>
     -------------------------------------------------------------------------------
     <br/>
    </td>
   </tr>
  </tbody>
 </table>
</div>
