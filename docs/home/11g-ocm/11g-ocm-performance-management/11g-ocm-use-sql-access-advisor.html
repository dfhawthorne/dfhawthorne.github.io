---
layout: default
title: '11G OCM Use SQL Access Advisor'
base-url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-access-advisor.html
breadcrumbs:
- title: 'Home'
  url: index.html
- title: '11G OCM'
  url: home/11g-ocm.html
- title: '11G OCM Performance Management'
  url: home/11g-ocm/11g-ocm-performance-management.html
- title: '11G OCM Use SQL Access Advisor'
  url: home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-access-advisor.html
table-of-contents:
- toc-url: References
  toc-text: References
- toc-url: Overview
  toc-text: Overview
- toc-url: Reading-Notes
  toc-text: Reading Notes
  toc-menu:
  - toc-url: SQL-Access-Advisor
    toc-text: SQL Access Advisor
- toc-url: Test-Case
  toc-text: Test Case
- toc-url: Procedure
  toc-text: Procedure
  toc-menu:
  - toc-url: Create-a-task
    toc-text: Create a task
  - toc-url: Define-the-workload
    toc-text: Define the workload
  - toc-url: Generate-the-recommendations
    toc-text: Generate the recommendations
  - toc-url: View-and-implement-the-recommendations
    toc-text: View and implement the recommendations
---
<div dir="ltr">
 <h3>
  <a name="TOC-References">
  </a>
  References
 </h3>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/toc.htm" rel="nofollow">
   Oracle® Database Concepts 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID0" rel="nofollow">
    Chapter 14, "Manageability"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID4" rel="nofollow">
     Application and SQL Tuning
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/toc.htm" rel="nofollow">
   Oracle® Database Performance Tuning Guide 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#insertedID0" rel="nofollow">
    Chapter 18, "SQL Access Advisor"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDEEBAI" rel="nofollow">
     Overview of the SQL Access Advisor
    </a>
   </li>
   <ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#i1026051" rel="nofollow">
      Create a task
     </a>
    </li>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABHBGCJ" rel="nofollow">
      Define the workload
     </a>
    </li>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABIBDGC" rel="nofollow">
      Generate the recommendations
     </a>
    </li>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABCCEBC" rel="nofollow">
      View and implement the recommendations
     </a>
    </li>
   </ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#i1026391" rel="nofollow">
     Using the SQL Access Advisor
    </a>
   </li>
   <ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDDEJGI" rel="nofollow">
      Setting Up Tasks and Templates
     </a>
    </li>
    <ul>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDBDGBC" rel="nofollow">
       Creating Tasks
      </a>
     </li>
    </ul>
    <li>
     <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#i1009077" rel="nofollow">
      Working with Recommendations
     </a>
    </li>
    <ul>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDFBEJF" rel="nofollow">
       Generating Recommendations
      </a>
     </li>
     <li>
      <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDJIGCD" rel="nofollow">
       Viewing Recommendations
      </a>
     </li>
    </ul>
   </ul>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/toc.htm" rel="nofollow">
   Oracle® Database PL/SQL Packages and Types Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
    Chapter 17, "DBMS_ADVISOR"
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#CIHHGIAJ" rel="nofollow">
     <span style="font-family:monospace">
      ADD_STS_REF
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1010465" rel="nofollow">
     <span style="font-family:monospace">
      CREATE_FILE
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1001232" rel="nofollow">
     <span style="font-family:monospace">
      CREATE_TASK
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#CIHDFJHD" rel="nofollow">
     <span style="font-family:monospace">
      EXECUTE_TASK
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#BCFDFJDJ" rel="nofollow">
     <span style="font-family:monospace">
      GET_TASK_REPORT
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1012023" rel="nofollow">
     <span style="font-family:monospace">
      GET_TASK_SCRIPT
     </span>
    </a>
   </li>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1001341" rel="nofollow">
     <span style="font-family:monospace">
      SET_TASK_PARAMETER
     </span>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/toc.htm" rel="nofollow">
   Oracle® Database Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_part.htm#i125539" rel="nofollow">
    Part II Static Data Dictionary Views
   </a>
  </li>
  <ul>
   <li>
    <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_3026.htm#i1616718" rel="nofollow">
     <span style="font-family:monospace">
      DBA_ADVISOR_RECOMMENDATIONS
     </span>
    </a>
   </li>
  </ul>
 </ul>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/toc.htm" rel="nofollow">
   Oracle® Database SQL Language Reference 11g Release 1 (11.1)
  </a>
 </p>
 <ul>
  <li>
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_5007.htm#i2061958" rel="nofollow">
    <span style="font-family:monospace">
     CREATE DIRECTORY
    </span>
   </a>
  </li>
 </ul>
 <p>
  <a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=BULLETIN&amp;id=259188.1" rel="nofollow">
   Oracle10g: Using SQLAccess Advisor (DBMS_ADVISOR) with the Automatic Workload Repository [ID 259188.1]
  </a>
 </p>
 <h3>
  <a name="TOC-Overview">
  </a>
  Overview
 </h3>
 <p>
  The objective from the
  <a href="http://education.oracle.com/pls/web_prod-plq-dad/db_pages.getpage?page_id=41&amp;p_exam_id=11gOCMU#3" rel="nofollow">
   11G OCM Upgrade Exam
  </a>
  is:
 </p>
 <blockquote>
  Use SQL Access Advisor
 </blockquote>
 <h3>
  <a name="TOC-Reading-Notes">
  </a>
  Reading Notes
 </h3>
 <h4>
  <a name="TOC-SQL-Access-Advisor">
  </a>
  SQL Access Advisor
 </h4>
 <p>
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28318/mgmt_db.htm#insertedID4" rel="nofollow">
   Application and SQL Tuning
  </a>
  says that:
 </p>
 <blockquote>
  <p>
   The SQL Access Advisor can automatically analyze the schema design for a given workload and recommend indexes, function-based indexes, partitions, and materialized views to create, retain, or drop as appropriate for the workload. For single statement scenarios, the advisor only recommends adjustments that affect the current statement. For complete business workloads, the advisor makes recommendations after considering the impact on the entire workload.
  </p>
 </blockquote>
 <h3>
  <a name="TOC-Test-Case">
  </a>
  Test Case
 </h3>
 <p>
  The test I am using is the SQL from
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-replay-a-captured-workload.html">
   Replay a captured workload
  </a>
  which has an SQL ID of 'dgdfqhj9ua2kv'.
 </p>
 <p>
  The test query is as follows:
 </p>
 <pre>SELECT
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year,
    SUM( sales.quantity_sold )
      AS total_quantity_sold,
    SUM( sales.amount_sold )
      AS total_amount_sold
  FROM
      sales
    INNER JOIN
      products
    USING( prod_id )
    INNER JOIN
      customers
    USING( cust_id )
    INNER JOIN
      countries
    USING( country_id )
    INNER JOIN
      channels
    USING( channel_id )
    INNER JOIN
      times
    USING( time_id )
  WHERE
      products.prod_valid = 'A'
    AND
      channels.channel_class = 'Direct'
    AND
      customers.cust_valid = 'A'
    AND
      countries.country_name = 'Australia'
  GROUP BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
  ORDER BY
    products.prod_category,
    products.prod_subcategory,
    times.calendar_year
;
</pre>
 <p>
  This query is about a yearly summary of product categories and sub-categories sold directly to active customers in Australia.
 </p>
 <p>
  This query was put into an SQL Tuning Set called
  <span>
   SYS.OCM11G
  </span>
  during the procedure outlined in
  <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-tuning-advisor.html">
   Use SQL Tuning Advisor
  </a>
  .
 </p>
 <h3>
  <a name="TOC-Procedure">
  </a>
  Procedure
 </h3>
 <h4>
  <a name="TOC-Create-a-task">
  </a>
  Create a task
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#i1026051" rel="nofollow">
   Create a task
  </a>
  and in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDBDGBC" rel="nofollow">
   Creating Tasks
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1001232" rel="nofollow">
   CREATE_TASK
  </a>
  (
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .SQLACCESS_ADVISOR, 'OCM11G' )
 </blockquote>
 <h4>
  <a name="TOC-Define-the-workload">
  </a>
  Define the workload
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABHBGCJ" rel="nofollow">
   Define the workload
  </a>
  for adding the SQL Tuning SET,
  <span style="font-family:monospace">
   SYS.OCM11G
  </span>
  , to the SQL Access Advisor task called '
  <span style="font-family:monospace">
   OCM11G
  </span>
  ':
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#CIHHGIAJ" rel="nofollow">
   ADD_STS_REF
  </a>
  ( 'OCM11G', 'SYS', 'OCM11G' )
 </blockquote>
 <p>
  I want to check for all possible recommendations. I need to modify the task parameters as follows:
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1001341" rel="nofollow">
   SET_TASK_PARAMETER
  </a>
  ( 'OCM11G', 'ANALYSIS_SCOPE', 'ALL' );
 </blockquote>
 <h4>
  <a name="TOC-Generate-the-recommendations">
  </a>
  Generate the recommendations
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABIBDGC" rel="nofollow">
   Generate the recommendations
  </a>
  and
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDFBEJF" rel="nofollow">
   Generating Recommendations
  </a>
  :
 </p>
 <blockquote style="font-family:monospace">
  EXEC
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#CIHDFJHD" rel="nofollow">
   EXECUTE_TASK
  </a>
  ( 'OCM11G' );
 </blockquote>
 <h4>
  <a name="TOC-View-and-implement-the-recommendations">
  </a>
  View and implement the recommendations
 </h4>
 <p>
  Followed the procedure in
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#BABCCEBC" rel="nofollow">
   View and implement the recommendations
  </a>
  and went to
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28274/advisor.htm#CHDJIGCD" rel="nofollow">
   Viewing Recommendations
  </a>
  where I found the following comment:
 </p>
 <blockquote>
  <p>
   Each recommendation generated by the SQL Access Advisor can be viewed using several catalog views, such as
   <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28320/statviews_3026.htm#i1616718" rel="nofollow">
    <span style="font-family:monospace">
     DBA_ADVISOR_RECOMMENDATIONS
    </span>
   </a>
   . However, it is easier to use the
   <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1012023" rel="nofollow">
    <span style="font-family:monospace">
     GET_TASK_SCRIPT
    </span>
   </a>
   procedure or use the SQL Access Advisor in Enterprise Manager, which graphically displays the recommendations and provides hyperlinks to quickly see which SQL statements benefit from a recommendation. Each recommendation produced by the SQL Access Advisor is linked to the SQL statement it benefits.
  </p>
 </blockquote>
 <p>
  When Itry to use the
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#BCFDFJDJ" rel="nofollow">
   <span style="font-family:monospace">
    GET_TASK_REPORT
   </span>
  </a>
  function as follows, I get an error message:
 </p>
 <blockquote style="font-family:monospace">
  SET LONG 10000
  <br/>
  SELECT
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#BCFDFJDJ" rel="nofollow">
   GET_TASK_REPORT
  </a>
  ( 'OCM11G' ) FROM DUAL;
 </blockquote>
 <p>
  The result is:
 </p>
 <blockquote style="font-family:monospace">
  ERROR:
  <br/>
  ORA-13699: Advisor feature is not currently implemented.
  <br/>
  ORA-06512: at "SYS.PRVT_ADVISOR", line 3122
  <br/>
  ORA-06512: at "SYS.DBMS_ADVISOR", line 585
  <br/>
  ORA-06512: at line 1
  <br/>
  <br/>
  no rows selected
  <br/>
 </blockquote>
 <p>
  I followed the procedure in
  <a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;doctype=BULLETIN&amp;id=259188.1" rel="nofollow">
   Oracle10g: Using SQLAccess Advisor (DBMS_ADVISOR) with the Automatic Workload Repository [ID 259188.1]
  </a>
  to generate a script. First, I created a directory:
 </p>
 <blockquote style="font-family:monospace">
  mkdir -p /u00/app/oracle/tuning/ocm11g
 </blockquote>
 <p>
  Then, I created a directory object called
  <span style="font-family:monospace">
   ADVISOR_RESULTS
  </span>
  :
 </p>
 <blockquote style="font-family:monospace">
  <a href="http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_5007.htm#i2061958" rel="nofollow">
   CREATE DIRECTORY
  </a>
  advisor_results AS '/u00/app/oracle/tuning/ocm11g';
 </blockquote>
 <p>
  And, I create a script called
  <span style="font-family:monospace">
   <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-access-advisor/ocm11g_sh_access.sql">
    ocm11g_sh_access.sql
   </a>
  </span>
  as follows:
 </p>
 <blockquote style="font-family:monospace">
  exec
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1010465" rel="nofollow">
   CREATE_FILE
  </a>
  (
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#insertedID0" rel="nofollow">
   DBMS_ADVISOR
  </a>
  .
  <a href="http://docs.oracle.com/cd/B28359_01/appdev.111/b28419/d_advis.htm#i1012023" rel="nofollow">
   GET_TASK_SCRIPT
  </a>
  ('OCM11G'), 'ADVISOR_RESULTS', 'ocm11g_sh_access.sql');
 </blockquote>
 <p>
  The resulting script file is uploaded as
  <span style="font-family:monospace">
   <a href="home/11g-ocm/11g-ocm-performance-management/11g-ocm-use-sql-access-advisor/ocm11g_sh_access.sql">
    ocm11g_sh_access.sql
   </a>
  </span>
  . None of the recommendations have been implemented.
 </p>
</div>
